(***********************************************************************
Title: AIM short form for ISO/NWI-CD 10303-238
Author: David Loffredo
Date: 2002-04-24
N-number: ISO TC184/SC4/WG3 N1111
***********************************************************************)

SCHEMA integrated_cnc_schema;

(*  AP-238 AIM shortform schema 

    Wed Apr 24 2002 -- WG3 N1111, schema distributed with NWI/CD ballot
    Thu Mar 07 2002 -- Added temporary rule restricing use of turning 
		       features.  Fixed EXPRESS problems in rules (entity
		       value compares changed to instance compares, added
		       group qualifier and guard to nc_variable rule).
    Sun Feb 24 2002 -- Changed return type of verify_* functions to logical,
		       corrected some warnings in several local rules.
    Sun Feb 24 2002 -- WG3 N1090, schema distributed with NWI/CD documents
		       for review at Myrtle Beach.
    All prior dates -- Draft schemas distributed with AIM versions
		       prior to v2.8

*)

USE FROM action_schema						 -- 10303-41
    (action,
     action_method,
     action_method_relationship,
     action_resource,
     action_resource_relationship,
     action_resource_type);

USE FROM aic_advanced_brep					 -- 10303-514
    (advanced_brep_shape_representation);

USE FROM aic_geometric_tolerances				 -- 10303-519
    (angularity_tolerance,
     circular_runout_tolerance,
     coaxiality_tolerance,
     common_datum,
     concentricity_tolerance,
     cylindricity_tolerance,
     flatness_tolerance,
     line_profile_tolerance,
     parallelism_tolerance,
     perpendicularity_tolerance,
     position_tolerance,
     roundness_tolerance,
     straightness_tolerance,
     surface_profile_tolerance,
     symmetry_tolerance,
     total_runout_tolerance);

USE FROM aic_geometrically_bounded_surface			 -- 10303-507
    (geometrically_bounded_surface_shape_representation);

USE FROM aic_manifold_surface					 -- 10303-509
    (manifold_surface_shape_representation);

USE FROM aic_topologically_bounded_surface			 -- 10303-511
    (advanced_face);

USE FROM application_context_schema				 -- 10303-41
    (application_context,
     application_context_element,
     application_protocol_definition,
     product_context,
     product_definition_context);

USE FROM approval_schema					 -- 10303-41
    (approval,
     approval_date_time,
     approval_person_organization,
     approval_status);

USE FROM date_time_schema					 -- 10303-41
    (calendar_date,
     date,
     date_and_time,
     ordinal_date,
     week_of_year_and_day_date);

USE FROM document_schema					 -- 10303-41
    (document);

USE FROM effectivity_schema					 -- 10303-41
    (dated_effectivity,
     effectivity,
     lot_effectivity,
     serial_numbered_effectivity,
     time_interval_based_effectivity);

USE FROM external_reference_schema				 -- 10303-41
    (externally_defined_item);

USE FROM geometric_model_schema					 -- 10303-42
    (block,
     right_circular_cylinder);

USE FROM geometry_schema					 -- 10303-42
    (bounded_curve,
     bounded_surface,
     elementary_surface);

USE FROM group_schema						 -- 10303-41
    (group,
     group_relationship);

USE FROM iso13584_expressions_schema				 -- 13584-20
    (and_expression,
     binary_boolean_expression,
     boolean_expression,
     comparison_equal,
     comparison_expression,
     comparison_greater,
     comparison_greater_equal,
     comparison_less,
     comparison_less_equal,
     comparison_not_equal,
     expression,
     int_literal,
     int_numeric_variable,
     literal_number,
     multiple_arity_boolean_expression,
     not_expression,
     numeric_expression,
     numeric_variable,
     or_expression,
     real_literal,
     real_numeric_variable,
     simple_numeric_expression,
     unary_boolean_expression,
     xor_expression);

USE FROM iso13584_generic_expressions_schema			 -- 13584-20
    (binary_generic_expression,
     generic_expression);

USE FROM management_resources_schema				 -- 10303-41
    (approval_assignment,
     classification_role,
     date_and_time_assignment,
     document_reference,
     document_usage_constraint_assignment,
     effectivity_assignment,
     group_assignment,
     person_and_organization_assignment,
     security_classification_assignment);

USE FROM material_property_definition_schema			 -- 10303-45
    (material_designation,
     material_designation_characterization,
     material_property);

USE FROM material_property_representation_schema		 -- 10303-45
    (material_property_representation);

USE FROM measure_schema						 -- 10303-41
    (context_dependent_measure,
     context_dependent_unit,
     conversion_based_unit,
     count_measure,
     derived_unit,
     descriptive_measure,
     global_unit_assigned_context,
     length_measure_with_unit,
     length_unit,
     measure_with_unit,
     named_unit,
     numeric_measure,
     parameter_value,
     plane_angle_measure_with_unit,
     plane_angle_unit,
     positive_plane_angle_measure,
     ratio_measure,
     ratio_measure_with_unit,
     ratio_unit,
     si_unit,
     solid_angle_measure,
     solid_angle_measure_with_unit,
     solid_angle_unit,
     time_measure,
     time_measure_with_unit,
     time_unit);

USE FROM method_definition_schema				 -- 10303-49
    (concurrent_action_method,
     sequential_method,
     serial_action_method);

USE FROM person_organization_schema				 -- 10303-41
    (organizational_address,
     person,
     person_and_organization,
     personal_address);

USE FROM process_property_representation_schema			 -- 10303-49
    (action_property_representation,
     resource_property_representation);

USE FROM process_property_schema				 -- 10303-49
    (action_property,
     action_resource_requirement,
     process_product_association,
     process_property_association,
     property_process,
     requirement_for_action_resource,
     resource_property,
     resource_requirement_type);

USE FROM product_definition_schema				 -- 10303-41
    (product,
     product_category,
     product_category_relationship,
     product_definition,
     product_definition_formation,
     product_definition_relationship,
     product_definition_with_associated_documents,
     product_related_product_category);

USE FROM product_property_definition_schema			 -- 10303-41
    (characterized_object,
     product_definition_shape,
     property_definition,
     shape_aspect,
     shape_aspect_relationship,
     shape_definition);

USE FROM product_property_representation_schema			 -- 10303-41
    (context_dependent_shape_representation,
     property_definition_representation,
     shape_definition_representation,
     shape_representation,
     shape_representation_relationship);

USE FROM product_structure_schema				 -- 10303-44
    (make_from_usage_option,
     next_assembly_usage_occurrence);

USE FROM qualified_measure_schema				 -- 10303-45
    (descriptive_representation_item,
     expanded_uncertainty,
     measure_qualification,
     measure_representation_item,
     precision_qualifier,
     qualified_representation_item,
     qualitative_uncertainty,
     standard_uncertainty,
     uncertainty_qualifier,
     value_qualifier);

USE FROM representation_schema					 -- 10303-43
    (compound_representation_item,
     global_uncertainty_assigned_context,
     item_defined_transformation,
     list_representation_item,
     representation,
     representation_item,
     representation_item_relationship,
     representation_relationship,
     representation_relationship_with_transformation,
     set_representation_item);

USE FROM security_classification_schema				 -- 10303-41
    (security_classification,
     security_classification_level);

USE FROM shape_aspect_definition_schema				 -- 10303-47
    (datum_target);

USE FROM shape_dimension_schema					 -- 10303-47
    (angular_location,
     angular_size,
     dimensional_characteristic_representation,
     dimensional_location_with_path,
     dimensional_size,
     dimensional_size_with_path,
     shape_dimension_representation);

USE FROM shape_tolerance_schema					 -- 10303-47
    (limits_and_fits,
     plus_minus_tolerance,
     tolerance_value);





(* ======================================== *)
(* ASSIGNMENT SUBTYPES *)

TYPE approval_item = SELECT (
        action_method, 
        action_method_relationship,
        action_property, 
        material_designation,
        product_definition_formation,
        requirement_for_action_resource, 
        resource_property
        );
END_TYPE; 

TYPE date_and_time_item = SELECT (
        approval_person_organization, 
        approval_status,
        effectivity,
        material_designation,
        person_and_organization, 
        product_definition_formation,
        security_classification, 
        security_classification_level
        );
END_TYPE;

TYPE document_reference_item = SELECT (
        action_method,
        externally_defined_feature_definition,
        material_designation,
        dimensional_characteristic_representation,
        property_definition
        );
END_TYPE;

TYPE effectivity_item = SELECT (
        action_method, 
        action_method_relationship,
        action_property, 
        material_designation,
        product_definition_formation,
        requirement_for_action_resource, 
        resource_property
        );
END_TYPE;

TYPE group_item = SELECT (
        instanced_feature, 
        replicate_feature, 
        transition_feature
        );
END_TYPE;

TYPE person_and_organization_item = SELECT (
        product_definition_formation 
        );
END_TYPE; 

TYPE security_classification_item = SELECT (
        product_definition_formation 
        );
END_TYPE;




ENTITY applied_approval_assignment
  SUBTYPE OF (approval_assignment);
  items : SET [1:?] OF approval_item;
END_ENTITY;

ENTITY applied_date_and_time_assignment
  SUBTYPE OF (date_and_time_assignment);
  items : SET[1:?] OF date_and_time_item;
END_ENTITY;

ENTITY applied_document_reference
  SUBTYPE OF (document_reference);
  items : SET [1:?] OF document_reference_item;
END_ENTITY;

ENTITY applied_document_usage_constraint_assignment
  SUBTYPE OF (document_usage_constraint_assignment);
  items : SET [1:?] OF document_reference_item;
END_ENTITY;

ENTITY applied_effectivity_assignment
  SUBTYPE OF (effectivity_assignment);
  items : SET[1:?] OF effectivity_item;
END_ENTITY;

ENTITY applied_group_assignment
  SUBTYPE OF (group_assignment);
  items : SET [1:?] OF group_item;
END_ENTITY;

ENTITY applied_person_and_organization_assignment
  SUBTYPE OF (person_and_organization_assignment);
  items : SET [1:?] OF person_and_organization_item;
END_ENTITY;

ENTITY applied_security_classification_assignment
  SUBTYPE OF (security_classification_assignment);
  items : SET [1:?] OF security_classification_item;
END_ENTITY;


(* ======================================== *)
(* GENERAL CNC PROCESS SUBTYPES (From Part 10) *)

ENTITY machining_process_executable
  SUBTYPE OF (action_method);
  WHERE
  WR1:  NOT (0 = SIZEOF (TYPEOF (SELF) * 
            ['INTEGRATED_CNC_SCHEMA.MACHINING_FEATURE_PROCESS',
             'INTEGRATED_CNC_SCHEMA.MACHINING_NC_FUNCTION',
             'INTEGRATED_CNC_SCHEMA.MACHINING_OPERATOR_INSTRUCTION',
             'INTEGRATED_CNC_SCHEMA.MACHINING_RAPID_MOVEMENT',
             'INTEGRATED_CNC_SCHEMA.MACHINING_TOUCH_PROBING',
             'INTEGRATED_CNC_SCHEMA.MACHINING_WORKINGSTEP',
             'INTEGRATED_CNC_SCHEMA.MACHINING_WORKPLAN']
        )) OR
        (SELF.description IN ['assignment', 'if statement',
                'non-sequential', 'parallel', 'selective',
                'while statement']);

  WR2:  NOT (SELF.description = 'assignment') OR
        ((verify_required_action_property       (SELF, 'lvalue')) AND
         (verify_rep_item_for_action_property   (SELF, 'lvalue',
          ['INTEGRATED_CNC_SCHEMA.EXPRESSION_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.NUMERIC_VARIABLE'])) AND

         (verify_required_action_property       (SELF, 'rvalue')) AND
         (verify_rep_item_for_action_property   (SELF, 'rvalue',
          ['INTEGRATED_CNC_SCHEMA.EXPRESSION_REPRESENTATION_ITEM'])));

  WR3:  NOT (SELF.description = 'if statement') OR
        ((verify_required_action_property       (SELF, 'condition')) AND
         (verify_rep_item_for_action_property   (SELF, 'condition',
          ['INTEGRATED_CNC_SCHEMA.EXPRESSION_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.BOOLEAN_EXPRESSION'])) AND

         (verify_required_relating_amr  (SELF, 'true branch')) AND
         (verify_related_type_for_amr   (SELF, 'true branch', 
          ['INTEGRATED_CNC_SCHEMA.MACHINING_PROCESS_EXECUTABLE'])) AND

         (verify_optional_relating_amr  (SELF, 'false branch')) AND
         (verify_related_type_for_amr   (SELF, 'false branch', 
          ['INTEGRATED_CNC_SCHEMA.MACHINING_PROCESS_EXECUTABLE']))
        );

  WR4:  NOT (SELF.description = 'while statement') OR
        ((verify_required_action_property       (SELF, 'condition')) AND
         (verify_rep_item_for_action_property   (SELF, 'condition',
          ['INTEGRATED_CNC_SCHEMA.EXPRESSION_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.BOOLEAN_EXPRESSION'])) AND

         (verify_required_relating_amr  (SELF, 'body')) AND
         (verify_related_type_for_amr   (SELF, 'body', 
          ['INTEGRATED_CNC_SCHEMA.MACHINING_PROCESS_EXECUTABLE']))
        );

  WR5:  NOT (SELF.description IN ['non-sequential', 'parallel']) OR
        (2 <= SIZEOF (QUERY (amr <* get_relating_amr (SELF) |
                ('INTEGRATED_CNC_SCHEMA.CONCURRENT_ACTION_METHOD' 
                 IN TYPEOF (amr)) AND
                ('INTEGRATED_CNC_SCHEMA.MACHINING_PROCESS_EXECUTABLE' 
                 IN TYPEOF (amr.related_method))))
        );

  WR6:  NOT (SELF.description = 'selective') OR
        ((2 <= SIZEOF (QUERY (amr <* get_relating_amr (SELF) |
                amr.name = 'branch'))) AND
         (verify_related_type_for_amr   (SELF, 'branch', 
          ['INTEGRATED_CNC_SCHEMA.MACHINING_PROCESS_EXECUTABLE']))
        );
END_ENTITY;



ENTITY machining_workingstep
  SUBTYPE OF (machining_process_executable);
  WHERE
  WR1:  ((verify_required_action_property       (SELF, 'security plane')) AND
         (verify_rep_item_for_action_property   (SELF, 'security plane',
          ['INTEGRATED_CNC_SCHEMA.ELEMENTARY_SURFACE'])));

  WR2:  ((verify_required_relating_amr  (SELF, 'final feature')) AND
         (verify_related_type_for_amr   (SELF, 'final feature', 
          ['INTEGRATED_CNC_SCHEMA.MACHINING_FEATURE_PROCESS']))
        );

  WR3:  ((verify_optional_relating_amr  (SELF, 'in-process feature')) AND
         (verify_related_type_for_amr   (SELF, 'in-process feature', 
          ['INTEGRATED_CNC_SCHEMA.MACHINING_FEATURE_PROCESS'])) 
        );

  WR4:  ((verify_required_relating_amr  (SELF, 'operation')) AND
         (verify_related_type_for_amr   (SELF, 'operation', 
          ['INTEGRATED_CNC_SCHEMA.MACHINING_OPERATION']))
        );

  WR5:  (verify_optional_in_process_geometry (SELF));
END_ENTITY;



ENTITY machining_workplan
  SUBTYPE OF (machining_process_executable);
  WHERE
  WR1:  (1 <= SIZEOF (QUERY (amr <* get_relating_amr (SELF) |
          ('INTEGRATED_CNC_SCHEMA.SEQUENTIAL_METHOD' IN TYPEOF (amr)) AND
          ('INTEGRATED_CNC_SCHEMA.MACHINING_PROCESS_EXECUTABLE' 
                 IN TYPEOF (amr.related_method))))
        );
 
  WR2:  (verify_optional_action_property (SELF, 'channel'));

  WR3:  (1 >= SIZEOF (QUERY (act <* 
          USEDIN (SELF, 'INTEGRATED_CNC_SCHEMA.ACTION.CHOSEN_METHOD') |
          (act.name = 'setup')))) AND
        (0 = SIZEOF (QUERY (act <* 
          USEDIN (SELF, 'INTEGRATED_CNC_SCHEMA.ACTION.CHOSEN_METHOD') |
          (act.name = 'setup') AND NOT
          ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_PROCESS' IN TYPEOF (act))
        )));

  WR4:  (verify_optional_in_process_geometry (SELF));
END_ENTITY;



ENTITY machining_feature_process
  SUBTYPE OF (machining_process_executable);
  WHERE
  WR1:  (1 = SIZEOF (QUERY (act <* 
          USEDIN (SELF, 'INTEGRATED_CNC_SCHEMA.ACTION.CHOSEN_METHOD') |
          (act.name = 'machining')))) AND
        (0 = SIZEOF (QUERY (act <* 
          USEDIN (SELF, 'INTEGRATED_CNC_SCHEMA.ACTION.CHOSEN_METHOD') |
          (act.name = 'machining') AND NOT
          ('INTEGRATED_CNC_SCHEMA.PROPERTY_PROCESS' IN TYPEOF (act))
        )));
END_ENTITY;



ENTITY machining_operator_instruction
  SUBTYPE OF (machining_process_executable);
  WHERE
  WR1:  EXISTS (self.description) OR
        (0 < SIZEOF (USEDIN (SELF, 'INTEGRATED_CNC_SCHEMA.' + 
                'APPLIED_DOCUMENT_REFERENCE.ITEMS'))
        );
END_ENTITY;


ENTITY machining_operation
  SUBTYPE OF (action_method);
  WHERE
  WR1: ((verify_related_type_for_amr    (SELF, 'toolpath', 
          ['INTEGRATED_CNC_SCHEMA.MACHINING_TOOLPATH'])) AND

        (0 = SIZEOF (QUERY (amr <* get_relating_amr (SELF) | 
            (amr.name = 'toolpath') AND NOT
            ('INTEGRATED_CNC_SCHEMA.SEQUENTIAL_METHOD' IN TYPEOF (amr)) )))
       );

  WR2:  ((verify_optional_action_property (SELF, 'tool direction')) AND
         (0 = SIZEOF (QUERY (prop <* 
            get_action_property (SELF, 'tool direction') | NOT 
            (0 < SIZEOF (QUERY (prep <* USEDIN (prop, 'INTEGRATED_CNC_SCHEMA.'+
               'ACTION_PROPERTY_REPRESENTATION.PROPERTY') |
               ('INTEGRATED_CNC_SCHEMA.MACHINING_TOOL_DIRECTION_REPRESENTATION'
                 IN TYPEOF(prep.representation)) )))
         )))
        );

  WR3:  ('INTEGRATED_CNC_SCHEMA.MACHINING_RAPID_MOVEMENT' IN TYPEOF(SELF)) OR
        ('INTEGRATED_CNC_SCHEMA.MACHINING_TOUCH_PROBING' IN TYPEOF(SELF)) OR
        ((verify_optional_action_property       (SELF, 'retract plane')) AND
         (verify_length_measure_action_property (SELF, 'retract plane')) AND

         (verify_optional_action_property       (SELF, 'cut start point')) AND
         (verify_rep_item_for_action_property   (SELF, 'cut start point', 
          ['INTEGRATED_CNC_SCHEMA.CARTESIAN_POINT'])) AND

         (1 = SIZEOF (QUERY (mt <*
          USEDIN (SELF, 'INTEGRATED_CNC_SCHEMA.ACTION_RESOURCE.USAGE') |
          ('INTEGRATED_CNC_SCHEMA.MACHINING_TOOL' in TYPEOF(mt))))) AND

         (verify_required_relating_amr  (SELF, 'technology')) AND
         (verify_related_type_for_amr   (SELF, 'technology', 
          ['INTEGRATED_CNC_SCHEMA.MACHINING_TECHNOLOGY'])) AND

         (verify_required_relating_amr  (SELF, 'machine functions')) AND
         (verify_related_type_for_amr   (SELF, 'machine functions', 
          ['INTEGRATED_CNC_SCHEMA.MACHINING_FUNCTIONS']))
        );
END_ENTITY;



ENTITY machining_technology
  SUBTYPE OF (action_method);
  WHERE
  WR1:  (verify_optional_action_property        (SELF, 'feedrate')) AND
        (verify_rep_item_for_action_property    (SELF, 'feedrate', 
          ['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM']));

  WR2:  (verify_required_action_property 
	  (SELF, 'feedrate reference')) AND
        (verify_enumeration_action_property 
	  (SELF, 'feedrate reference',
          ['tool center point', 'cutter contact point']));

  WR3:  NOT (SELF.description = 'milling') OR
        ((verify_optional_action_property       (SELF, 'cutspeed')) AND
         (verify_rep_item_for_action_property   (SELF, 'cutspeed',
          ['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM'])) AND

         (verify_optional_action_property       (SELF, 'spindle')) AND
         (verify_rep_item_for_action_property   (SELF, 'spindle',
          ['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM'])) AND

         (verify_optional_action_property 
	   (SELF, 'feedrate per tooth')) AND
         (verify_length_measure_action_property 
	   (SELF, 'feedrate per tooth')) AND

         (verify_required_action_property 
	   (SELF, 'synchronize spindle with feed')) AND
         (verify_enumeration_action_property 
	   (SELF, 'synchronize spindle with feed',
           ['synchronized', 'not synchronized'])) AND

         (verify_required_action_property 
	   (SELF, 'inhibit feedrate override')) AND
         (verify_enumeration_action_property 
	   (SELF, 'inhibit feedrate override',
           ['override allowed', 'override not allowed'])) AND

         (verify_required_action_property 
	   (SELF, 'inhibit spindle override')) AND
         (verify_enumeration_action_property     
	   (SELF, 'inhibit spindle override',
           ['override allowed', 'override not allowed'])) AND

         (verify_optional_relating_amr  (SELF, 'adaptive control')) AND
         (verify_related_type_for_amr   (SELF, 'adaptive control', 
          ['INTEGRATED_CNC_SCHEMA.MACHINING_ADAPTIVE_CONTROL_STRATEGY']))
        );

  WR4:  NOT (SELF.description = 'milling') OR
        ((verify_required_action_property (SELF, 'cutspeed') XOR
          verify_required_action_property (SELF, 'spindle')) OR
         (verify_required_relating_amr    (SELF, 'adaptive control'))
        );

  WR5:  NOT (SELF.description = 'milling') OR
        ((verify_required_action_property (SELF, 'feedrate') XOR
          verify_required_action_property (SELF, 'feedrate per tooth')) OR
         (verify_required_relating_amr    (SELF, 'adaptive control'))
        );
END_ENTITY;


ENTITY machining_functions
  SUBTYPE OF (action_method);
  WHERE
  WR1:  NOT (SELF.description = 'milling') OR
        ((verify_required_action_property       (SELF, 'coolant')) AND
         (verify_enumeration_action_property    (SELF, 'coolant',
           ['coolant on', 'coolant off'])) AND

         (verify_optional_action_property       (SELF, 'coolant pressure')) AND
         (verify_rep_item_for_action_property   (SELF, 'coolant pressure',
          ['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM'])) AND

         (verify_optional_action_property       (SELF, 'mist')) AND
         (verify_enumeration_action_property    (SELF, 'mist',
           ['mist on', 'mist off'])) AND

         (verify_required_action_property 
	   (SELF, 'through spindle coolant')) AND
         (verify_enumeration_action_property    
	   (SELF, 'through spindle coolant',
           ['through spindle coolant on', 'through spindle coolant off'])) AND

         (verify_optional_action_property 
	   (SELF, 'through spindle pressure')) AND
         (verify_rep_item_for_action_property 
	   (SELF, 'through spindle pressure',
           ['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM'])) AND

         (verify_optional_action_property       (SELF, 'axis clamping')) AND
         (0 = SIZEOF (QUERY (prop <* 
           get_action_property (SELF, 'axis clamping') | NOT 
           (0 < SIZEOF (QUERY (prep <* USEDIN (prop, 'INTEGRATED_CNC_SCHEMA.' +
              'ACTION_PROPERTY_REPRESENTATION.PROPERTY') |
             (1 = SIZEOF (QUERY (it <* prep.representation.items |
                (('INTEGRATED_CNC_SCHEMA.COMPOUND_REPRESENTATION_ITEM' 
		   IN TYPEOF(it)) AND
                 ('INTEGRATED_CNC_SCHEMA.LIST_REPRESENTATION_ITEM' 
		   IN TYPEOF(it.item_element)) AND
                 (0 = SIZEOF (QUERY (ie <* it.item_element | NOT
                   ('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
		    IN TYPEOF(ie)) )))
             ))))
           ))) 
         ))) AND

         (verify_required_action_property       (SELF, 'chip removal')) AND
         (verify_enumeration_action_property    (SELF, 'chip removal',
           ['chip removal on', 'chip removal off'])) AND

         (verify_optional_action_property 
	   (SELF, 'oriented spindle stop')) AND
         (verify_rep_item_for_action_property 
	   (SELF, 'oriented spindle stop', 
	   ['INTEGRATED_CNC_SCHEMA.DIRECTION'])) AND

         (verify_related_type_for_amr    (SELF, 'process model', 
          ['INTEGRATED_CNC_SCHEMA.MACHINING_PROCESS_MODEL'])) AND
         (0 = SIZEOF (QUERY (amr <* get_relating_amr (SELF) | 
             (amr.name = 'process model') AND NOT
             ('INTEGRATED_CNC_SCHEMA.SEQUENTIAL_METHOD' 
	       IN TYPEOF (amr)) ))) AND

         (verify_optional_action_property (SELF, 'other functions')) AND
         (0 = SIZEOF (QUERY (prop <* get_action_property 
			     (SELF, 'other functions') | NOT 
           (0 < SIZEOF (QUERY (prep <* USEDIN (prop, 'INTEGRATED_CNC_SCHEMA.' +
              'ACTION_PROPERTY_REPRESENTATION.PROPERTY') |
             (1 = SIZEOF (QUERY (it <* prep.representation.items |
                (('INTEGRATED_CNC_SCHEMA.COMPOUND_REPRESENTATION_ITEM' 
		   IN TYPEOF(it)) AND
                 ('INTEGRATED_CNC_SCHEMA.SET_REPRESENTATION_ITEM' 
		   IN TYPEOF(it.item_element)))
             )))
           ))) 
         )))
        );
END_ENTITY;




ENTITY machining_toolpath
  SUBTYPE OF (action_method);
  WHERE
  WR1:  (verify_required_action_property        (SELF, 'priority')) AND
        (verify_enumeration_action_property     (SELF, 'priority',
         ['required', 'suggested']));

  WR2:  (verify_required_action_property        (SELF, 'trajectory type')) AND
        (verify_enumeration_action_property     (SELF, 'trajectory type',
         ['approach', 'lift', 'connect', 'non-contact', 
          'contact', 'trajectory path']));


  WR3:  ((verify_optional_action_property        (SELF, 'speed profile')) AND
         (0 = SIZEOF (QUERY (prop <* 
           get_action_property (SELF, 'speed profile') | NOT 
           (0 < SIZEOF (QUERY (prep <* USEDIN (prop, 
                'INTEGRATED_CNC_SCHEMA.' + 
                'ACTION_PROPERTY_REPRESENTATION.PROPERTY') |
                ('INTEGRATED_CNC_SCHEMA.' + 
		 'MACHINING_TOOLPATH_SPEED_PROFILE_REPRESENTATION' 
                 IN TYPEOF(prep.representation)) )))
         )))
        );

  WR4:  (verify_optional_relating_amr   (SELF, 'technology')) AND
        (verify_related_type_for_amr    (SELF, 'technology', 
          ['INTEGRATED_CNC_SCHEMA.MACHINING_TECHNOLOGY']));


  WR5:  (verify_optional_relating_amr   (SELF, 'machine functions')) AND
        (verify_related_type_for_amr    (SELF, 'machine functions', 
          ['INTEGRATED_CNC_SCHEMA.MACHINING_FUNCTIONS']));
END_ENTITY;


ENTITY machining_process_model
  SUBTYPE OF (action_method);
  WHERE
  WR1:  (verify_required_action_property    (SELF, 'initialization data')) AND
        (verify_descriptive_action_property (SELF, 'initialization data'));
END_ENTITY;



(* ======================================== *)
(* MIXED EXECUTABLE / OPERATION SUBTYPES *)



ENTITY machining_rapid_movement
  SUBTYPE OF (machining_process_executable, machining_operation);
  WHERE
  WR1:  ((verify_required_action_property       (SELF, 'security plane')) AND
         (verify_rep_item_for_action_property   (SELF, 'security plane',
          ['INTEGRATED_CNC_SCHEMA.ELEMENTARY_SURFACE'])));
END_ENTITY;



ENTITY machining_touch_probing
  SUBTYPE OF (machining_process_executable, machining_operation);
  WHERE
  WR1:  (SELF.description IN ['tool length probing', 'tool radius probing',
          'workpiece probing', 'workpiece complete probing']);

  WR2:  ((verify_required_action_property       (SELF, 'security plane')) AND
         (verify_rep_item_for_action_property   (SELF, 'security plane',
          ['INTEGRATED_CNC_SCHEMA.ELEMENTARY_SURFACE'])));

  WR3:  ((verify_required_action_property       (SELF, 'measured offset')) AND
         (verify_rep_item_for_action_property   (SELF, 'measured offset',
          ['INTEGRATED_CNC_SCHEMA.EXPRESSION_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.NUMERIC_VARIABLE'])));

  WR4:  NOT (SELF.description = 'workpiece probing') OR
        ((verify_required_action_property       (SELF, 'start position')) AND
         (verify_rep_item_for_action_property   (SELF, 'start position',
          ['INTEGRATED_CNC_SCHEMA.AXIS2_PLACEMENT_3D'])) AND

        (1 = SIZEOF (QUERY (act <* 
          USEDIN (SELF, 'INTEGRATED_CNC_SCHEMA.ACTION.CHOSEN_METHOD') |
          (act.name = 'workpiece probing')))) AND
        (0 = SIZEOF (QUERY (act <* 
          USEDIN (SELF, 'INTEGRATED_CNC_SCHEMA.ACTION.CHOSEN_METHOD') |
          (act.name = 'workpiece probing') AND NOT
          ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_PROCESS' 
	    IN TYPEOF (act))))) AND

         (verify_required_action_property       (SELF, 'direction')) AND
         (verify_rep_item_for_action_property   (SELF, 'direction',
          ['INTEGRATED_CNC_SCHEMA.DIRECTION'])) AND

         (verify_required_action_property       (SELF, 'expected value')) AND
         (verify_rep_item_for_action_property   (SELF, 'expected value',
          ['INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT',
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.QUALIFIED_REPRESENTATION_ITEM'])) AND

         (verify_required_action_property       (SELF, 'probe'))
        );

  WR5:  NOT (SELF.description = 'workpiece complete probing') OR
        ((1 = SIZEOF (QUERY (act <* 
          USEDIN (SELF, 'INTEGRATED_CNC_SCHEMA.ACTION.CHOSEN_METHOD') |
          (act.name = 'workpiece complete probing')))) AND
         (0 = SIZEOF (QUERY (act <* 
          USEDIN (SELF, 'INTEGRATED_CNC_SCHEMA.ACTION.CHOSEN_METHOD') |
          (act.name = 'workpiece complete probing') AND NOT
          ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_PROCESS' 
            IN TYPEOF (act))))) AND

         (verify_required_action_property       (SELF, 'probing distance')) AND
         (verify_rep_item_for_action_property   (SELF, 'probing distance',
          ['INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT',
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.QUALIFIED_REPRESENTATION_ITEM'])) AND

         (verify_required_action_property       (SELF, 'probe')) AND

         (verify_required_action_property       (SELF, 'computed offset')) AND
         (0 = SIZEOF (QUERY (prop <* 
            get_action_property (SELF, 'computed offset') | NOT 
            (0 < SIZEOF (QUERY (prep <* USEDIN (prop, 
                'INTEGRATED_CNC_SCHEMA.' +
                'ACTION_PROPERTY_REPRESENTATION.PROPERTY') |
                ('INTEGRATED_CNC_SCHEMA.' +
                 'MACHINING_OFFSET_VECTOR_REPRESENTATION' 
                  IN TYPEOF(prep.representation)) )))
         )))
        );

  WR6:  NOT (SELF.description IN ['tool length probing', 
          'tool radius probing']) OR
        ((verify_required_action_property       (SELF, 'offset')) AND
         (verify_rep_item_for_action_property   (SELF, 'offset',
          ['INTEGRATED_CNC_SCHEMA.CARTESIAN_POINT'])) AND

         (verify_required_action_property       (SELF, 'maximum wear')) AND
         (verify_length_measure_action_property (SELF, 'maximum wear')) AND

         (1 = SIZEOF (QUERY (mt <*
          USEDIN (SELF, 'INTEGRATED_CNC_SCHEMA.ACTION_RESOURCE.USAGE') |
          ('INTEGRATED_CNC_SCHEMA.MACHINING_TOOL' in TYPEOF(mt)))))
        );
END_ENTITY;



ENTITY machining_nc_function
  SUBTYPE OF (machining_process_executable);
  WHERE
  WR1:  (SELF.description IN ['display message',
        'optional stop', 'program stop', 'set mark', 'wait for mark',
        'exchange pallet', 'index pallet', 'load tool', 'unload tool']);

  WR2:  NOT (SELF.description = 'display message') OR
        ((verify_required_action_property       (SELF, 'message text')) AND
         (verify_descriptive_action_property    (SELF, 'message text')));

  WR3:  NOT (SELF.description = 'wait for mark') OR
        ((verify_required_action_property       (SELF, 'channel')));

  WR4:  NOT (SELF.description = 'index pallet') OR
        ((verify_required_action_property       (SELF, 'pallet index')) AND
         (verify_parameter_action_property      (SELF, 'pallet index')));

  WR5:  NOT (SELF.description = 'index table') OR
        ((verify_required_action_property       (SELF, 'table index')) AND
         (verify_parameter_action_property      (SELF, 'table index')));

  WR6:  NOT (SELF.description = 'load tool') OR
        (1 = SIZEOF (QUERY (mt <*
         USEDIN (SELF, 'INTEGRATED_CNC_SCHEMA.ACTION_RESOURCE.USAGE') |
         ('INTEGRATED_CNC_SCHEMA.MACHINING_TOOL' in TYPEOF(mt)))));

  WR7:  NOT (SELF.description = 'unload tool') OR
        (1 >= SIZEOF (QUERY (mt <*
         USEDIN (SELF, 'INTEGRATED_CNC_SCHEMA.ACTION_RESOURCE.USAGE') |
         ('INTEGRATED_CNC_SCHEMA.MACHINING_TOOL' in TYPEOF(mt)))));

END_ENTITY;



(* ======================================== *)
(* MILLING OPERATION SUBTYPES (From Part 11) *)


ENTITY milling_type_operation
  SUBTYPE OF (machining_operation);
  WHERE
  WR1:  (verify_optional_action_property        (SELF, 'overcut length')) AND
        (verify_length_measure_action_property  (SELF, 'overcut length'));

  WR2:  ((verify_optional_relating_amr  (SELF, 'approach strategy')) AND
         (verify_related_type_for_amr   (SELF, 'approach strategy', 
          ['INTEGRATED_CNC_SCHEMA.MACHINING_APPROACH_RETRACT_STRATEGY'])) 
        );

  WR3:  ((verify_optional_relating_amr  (SELF, 'retract strategy')) AND
         (verify_related_type_for_amr   (SELF, 'retract strategy', 
          ['INTEGRATED_CNC_SCHEMA.MACHINING_APPROACH_RETRACT_STRATEGY'])) 
        );

  WR4:  ((verify_optional_relating_amr  (SELF, 'machining strategy')) AND
         (verify_related_type_for_amr   (SELF, 'machining strategy', 
          ['INTEGRATED_CNC_SCHEMA.MILLING_TYPE_STRATEGY'])) 
        );
END_ENTITY;


ENTITY freeform_milling_operation
  SUBTYPE OF (milling_type_operation);
  WHERE
  WR1:  (verify_related_type_for_amr   (SELF, 'machining strategy', 
          ['INTEGRATED_CNC_SCHEMA.FREEFORM_MILLING_STRATEGY']));
END_ENTITY;



ENTITY bottom_and_side_milling_operation
  SUBTYPE OF (milling_type_operation);
  WHERE
  WR1:  (SELF.description IN ['rough milling','finish milling']);

  WR2:  (verify_optional_action_property        (SELF, 'axial cutting depth')) AND
        (verify_length_measure_action_property  (SELF, 'axial cutting depth'));

  WR3:  (verify_optional_action_property        (SELF, 'radial cutting depth')) AND
        (verify_length_measure_action_property  (SELF, 'radial cutting depth'));

  WR4:  (verify_optional_action_property        (SELF, 'allowance side')) AND
        (verify_length_measure_action_property  (SELF, 'allowance side'));

  WR5:  (verify_optional_action_property        (SELF, 'allowance bottom')) AND
        (verify_length_measure_action_property  (SELF, 'allowance bottom'));

  WR6:  NOT (SELF.description = 'rough milling') OR
        ((verify_required_action_property (SELF, 'allowance side')) AND
         (verify_required_action_property (SELF, 'allowance bottom')));
END_ENTITY;


ENTITY side_milling_operation
  SUBTYPE OF (milling_type_operation);
  WHERE
  WR1:  (SELF.description IN ['rough milling','finish milling']);

  WR2:  (verify_optional_action_property        (SELF, 'axial cutting depth')) AND
        (verify_length_measure_action_property  (SELF, 'axial cutting depth'));

  WR3:  (verify_optional_action_property        (SELF, 'radial cutting depth')) AND
        (verify_length_measure_action_property  (SELF, 'radial cutting depth'));

  WR4:  (verify_optional_action_property        (SELF, 'allowance side')) AND
        (verify_length_measure_action_property  (SELF, 'allowance side'));

  WR5:  NOT (SELF.description = 'rough milling') OR
        (verify_required_action_property (SELF, 'allowance side'));
END_ENTITY;


ENTITY plane_milling_operation
  SUBTYPE OF (milling_type_operation);
  WHERE
  WR1:  (SELF.description IN ['rough milling','finish milling']);

  WR2:  (verify_optional_action_property        (SELF, 'axial cutting depth')) AND
        (verify_length_measure_action_property  (SELF, 'axial cutting depth'));

  WR3:  (verify_optional_action_property        (SELF, 'allowance bottom')) AND
        (verify_length_measure_action_property  (SELF, 'allowance bottom'));

  WR4:  NOT (SELF.description = 'rough milling') OR
        (verify_required_action_property (SELF, 'allowance bottom'));
END_ENTITY;



ENTITY drilling_type_operation
  SUBTYPE OF (machining_operation);
  WHERE
  WR1:  (verify_optional_action_property        (SELF, 'overcut length')) AND
        (verify_length_measure_action_property  (SELF, 'overcut length'));

  WR2:  (verify_optional_action_property        (SELF, 'cutting depth')) AND
        (verify_length_measure_action_property  (SELF, 'cutting depth'));

  WR3:  (verify_optional_action_property        (SELF, 'previous diameter')) AND
        (verify_length_measure_action_property  (SELF, 'previous diameter'));

  WR4:  (verify_optional_action_property        (SELF, 'dwell time bottom')) AND
        (verify_time_measure_action_property    (SELF, 'dwell time bottom'));

  WR5:  (verify_optional_action_property        (SELF, 'feed on retract')) AND
        (verify_ratio_measure_action_property   (SELF, 'feed on retract'));

  WR6:  ((verify_optional_relating_amr  (SELF, 'machining strategy')) AND
         (verify_related_type_for_amr   (SELF, 'machining strategy', 
          ['INTEGRATED_CNC_SCHEMA.DRILLING_TYPE_STRATEGY']))
        );
END_ENTITY;


ENTITY drilling_operation
  SUBTYPE OF (drilling_type_operation);
  WHERE
  WR1:  (SELF.description IN ['drilling','counter sinking',
         'center drilling', 'multistep drilling']);

  WR2:  NOT (SELF.description = 'multistep drilling') OR
        ((verify_required_action_property       (SELF, 'retract distance')) AND
         (verify_length_measure_action_property (SELF, 'retract distance')) AND

         (verify_required_action_property       (SELF, 'first depth')) AND
         (verify_length_measure_action_property (SELF, 'first depth')) AND

         (verify_required_action_property       (SELF, 'depth of step')) AND
         (verify_length_measure_action_property (SELF, 'depth of step')) AND

         (verify_optional_action_property       (SELF, 'dwell time step')) AND
         (verify_time_measure_action_property   (SELF, 'dwell time step')));
END_ENTITY;



ENTITY boring_operation
  SUBTYPE OF (drilling_type_operation);
  WHERE
  WR1:  (SELF.description IN ['boring','reaming']);

  WR2:  (verify_required_action_property        (SELF, 'spindle stop')) AND
        (verify_enumeration_action_property     (SELF, 'spindle stop',
         ['spindle stop at bottom', 'spindle nonstop']));

  WR3:  (verify_optional_action_property        (SELF, 'testcut depth')) AND
        (verify_length_measure_action_property  (SELF, 'testcut depth'));

  WR4:  (verify_optional_action_property        (SELF, 'waiting position')) AND
        (verify_rep_item_for_action_property    (SELF, 'waiting position',
         ['INTEGRATED_CNC_SCHEMA.CARTESIAN_POINT']));
END_ENTITY;



ENTITY back_boring_operation
  SUBTYPE OF (drilling_type_operation);
  WHERE
  WR1:  (0 = SIZEOF (QUERY (amr <* get_relating_amr (SELF) | 
           (amr.name = 'machine functions') AND NOT
           (verify_required_action_property 
		(amr.related_method, 'oriented spindle stop')))));
END_ENTITY;


ENTITY tapping_operation
  SUBTYPE OF (drilling_type_operation);
  WHERE
  WR1:  (SELF.description IN ['tapping','thread drilling']);

  WR2:  NOT (SELF.description = 'tapping') OR
        ((verify_required_action_property    (SELF, 'compensation chuck')) AND
         (verify_enumeration_action_property (SELF, 'compensation chuck',
          ['compensation chuck used', 'compensation chuck not used'])));

  WR3:  NOT (SELF.description = 'thread drilling') OR
        ((verify_required_action_property    (SELF, 'helical movement on forward')) AND
         (verify_enumeration_action_property (SELF, 'helical movement on forward',
          ['helical movement on forward', 'no helical movement on forward'])));
END_ENTITY;



(* ======================================== *)
(* MILLING STRATEGY SUBTYPES (From Part 11) *)


ENTITY machining_strategy
  SUBTYPE OF (action_method);
END_ENTITY;



ENTITY machining_adaptive_control_strategy
  SUBTYPE OF (machining_strategy);
END_ENTITY;



ENTITY machining_approach_retract_strategy
  SUBTYPE OF (machining_strategy);
  WHERE
  WR1:  (SELF.description IN ['along path',
         'approach retract angle', 'approach retract tangent', 
         'plunge helix', 'plunge ramp', 'plunge toolaxis', 
         'plunge zigzag']);

  WR2:  (verify_optional_action_property       (SELF, 'tool orientation')) AND
        (verify_rep_item_for_action_property   (SELF, 'tool orientation',
          ['INTEGRATED_CNC_SCHEMA.DIRECTION']));

  WR3:  NOT (SELF.description = 'along path') OR
        ((1 <= SIZEOF (QUERY (amr <* get_relating_amr (SELF) |
                amr.name = 'toolpath'))) AND

         (0 = SIZEOF (QUERY (amr <* get_relating_amr (SELF) | 
                (amr.name = 'toolpath') AND NOT
                (('INTEGRATED_CNC_SCHEMA.SEQUENTIAL_METHOD' 
                   IN TYPEOF (amr)) AND
                 ('INTEGRATED_CNC_SCHEMA.MACHINING_TOOLPATH' 
                   IN TYPEOF (amr.related_method))) )))
        );

  WR4:  NOT (SELF.description = 'approach retract angle') OR
        ((verify_required_action_property       (SELF, 'travel angle')) AND
         (verify_angle_measure_action_property  (SELF, 'travel angle')) AND

         (verify_required_action_property       (SELF, 'travel length')) AND
         (verify_length_measure_action_property (SELF, 'travel length')));

  WR5:  NOT (SELF.description = 'approach retract tangent') OR
        ((verify_required_action_property       (SELF, 'travel radius')) AND
         (verify_length_measure_action_property (SELF, 'travel radius')));

  WR6:  NOT (SELF.description IN ['plunge helix', 'plunge ramp', 'plunge zigzag']) OR
        ((verify_required_action_property       (SELF, 'plunge angle')) AND
         (verify_angle_measure_action_property  (SELF, 'plunge angle')));

  WR7:  NOT (SELF.description = 'plunge helix') OR
        ((verify_required_action_property       (SELF, 'plunge radius')) AND
         (verify_length_measure_action_property (SELF, 'plunge radius')));

  WR8:  NOT (SELF.description = 'plunge zigzag') OR
        ((verify_required_action_property       (SELF, 'plunge width')) AND
         (verify_length_measure_action_property (SELF, 'plunge width')));
END_ENTITY;


ENTITY drilling_type_strategy
  SUBTYPE OF (machining_strategy);
  WHERE
  WR1:  (verify_optional_action_property        (SELF, 'reduced cut at start')) AND
        (verify_ratio_measure_action_property   (SELF, 'reduced cut at start'));

  WR2:  (verify_optional_action_property        (SELF, 'reduced feed at start')) AND
        (verify_ratio_measure_action_property   (SELF, 'reduced feed at start'));

  WR3:  (verify_optional_action_property        (SELF, 'depth of start')) AND
        (verify_length_measure_action_property  (SELF, 'depth of start'));

  WR4:  (verify_optional_action_property        (SELF, 'reduced cut at end')) AND
        (verify_ratio_measure_action_property   (SELF, 'reduced cut at end'));

  WR5:  (verify_optional_action_property        (SELF, 'reduced feed at end')) AND
        (verify_ratio_measure_action_property   (SELF, 'reduced feed at end'));

  WR6:  (verify_optional_action_property        (SELF, 'depth of end')) AND
        (verify_length_measure_action_property  (SELF, 'depth of end'));

  WR7:  (verify_required_action_property (SELF, 'depth of start')) OR
        ((0 = SIZEOF (get_action_property (SELF, 'reduced cut at start'))) AND
         (0 = SIZEOF (get_action_property (SELF, 'reduced feed at start'))));

  WR8:  (verify_required_action_property (SELF, 'depth of end')) OR
        ((0 = SIZEOF (get_action_property (SELF, 'reduced cut at end'))) AND
         (0 = SIZEOF (get_action_property (SELF, 'reduced feed at end'))));
END_ENTITY;



ENTITY milling_type_strategy
  SUBTYPE OF (machining_strategy);
  WHERE
  WR1:  NOT (SELF.description IN ['bidirectional', 'bidirectional contour', 
          'center milling', 'contour bidirectional', 'contour parallel', 
          'contour spiral', 'explicit', 'unidirectional']) OR
        ((verify_optional_action_property       (SELF, 'overlap ratio')) AND
         (verify_ratio_measure_action_property  (SELF, 'overlap ratio')) AND

         (verify_optional_action_property       (SELF, 'multiple passes')) AND
         (verify_enumeration_action_property    (SELF, 'multiple passes',
          ['multiple passes allowed', 'multiple passes not allowed'])) );

  WR2:  NOT (SELF.description = 'bidirectional') OR
        ((verify_optional_action_property       (SELF, 'feed direction')) AND
         (verify_rep_item_for_action_property   (SELF, 'feed direction',
           ['INTEGRATED_CNC_SCHEMA.DIRECTION'])) AND

         (verify_optional_action_property       (SELF, 'stepover direction')) AND
         (verify_enumeration_action_property    (SELF, 'stepover direction',
           ['left', 'right'])) AND

         (verify_optional_action_property       (SELF, 'connection strategy')) AND
         (verify_enumeration_action_property    (SELF, 'connection strategy',
           ['straight line', 'lift shift plunge', 'degouge', 'loop back'])) );

  WR3:  NOT (SELF.description IN ['bidirectional contour', 
                'contour bidirectional']) OR
        ((verify_optional_action_property       (SELF, 'feed direction')) AND
         (verify_rep_item_for_action_property   (SELF, 'feed direction',
           ['INTEGRATED_CNC_SCHEMA.DIRECTION'])) AND

         (verify_optional_action_property       (SELF, 'stepover direction')) AND
         (verify_enumeration_action_property    (SELF, 'stepover direction',
           ['left', 'right'])) AND

         (verify_optional_action_property       (SELF, 'rotation direction')) AND
         (verify_enumeration_action_property    (SELF, 'rotation direction',
           ['clockwise', 'counterclockwise'])) AND

         (verify_optional_action_property       (SELF, 'spiral cutmode')) AND
         (verify_enumeration_action_property    (SELF, 'spiral cutmode',
           ['climb', 'conventional'])) );

  WR4:  NOT (SELF.description IN ['contour parallel', 'contour spiral']) OR
        ((verify_optional_action_property       (SELF, 'rotation direction')) AND
         (verify_enumeration_action_property    (SELF, 'rotation direction',
           ['clockwise', 'counterclockwise'])) AND

         (verify_optional_action_property       (SELF, 'cutmode')) AND
         (verify_enumeration_action_property    (SELF, 'cutmode',
           ['climb', 'conventional'])) );

  WR5:  NOT (SELF.description = 'unidirectional') OR
        ((verify_optional_action_property       (SELF, 'feed direction')) AND
         (verify_rep_item_for_action_property   (SELF, 'feed direction',
           ['INTEGRATED_CNC_SCHEMA.DIRECTION'])) AND

         (verify_optional_action_property       (SELF, 'cutmode')) AND
         (verify_enumeration_action_property    (SELF, 'cutmode',
           ['climb', 'conventional'])) );
END_ENTITY;

ENTITY freeform_milling_strategy
  SUBTYPE OF (milling_type_strategy);
  WHERE
  WR1:  NOT (SELF.description IN ['leading line', 'plane cutter contact',
          'plane cutter location', 'uv']) OR
        ((verify_required_action_property       (SELF, 'pathmode')) AND
         (verify_enumeration_action_property    (SELF, 'pathmode',
           ['forward', 'zigzag'])) AND

         (verify_required_action_property       (SELF, 'cutmode')) AND
         (verify_enumeration_action_property    (SELF, 'cutmode',
           ['climb', 'conventional'])) AND

         (verify_required_action_property       (SELF, 'milling tolerances')) AND
         (0 = SIZEOF (QUERY (prop <* get_action_property (SELF, 'milling tolerances') |
           NOT (0 < SIZEOF (QUERY (prep <* USEDIN (prop, 
                'INTEGRATED_CNC_SCHEMA.ACTION_PROPERTY_REPRESENTATION.PROPERTY') |
                ('INTEGRATED_CNC_SCHEMA.FREEFORM_MILLING_TOLERANCE_REPRESENTATION' 
                 IN TYPEOF(prep.representation)) )))
         ))) AND

         (verify_optional_action_property       (SELF, 'stepover length')) AND
         (verify_length_measure_action_property (SELF, 'stepover length')) );

  WR2:  NOT (SELF.description = 'leading line') OR
        ((verify_required_action_property       (SELF, 'leading line')) AND
         (verify_rep_item_for_action_property   (SELF, 'leading line',
           ['INTEGRATED_CNC_SCHEMA.BOUNDED_CURVE'])) );

  WR3:  NOT (SELF.description IN ['plane cutter contact', 'plane cutter location']) OR
        ((verify_required_action_property       (SELF, 'plane normal')) AND
         (verify_rep_item_for_action_property   (SELF, 'plane normal',
           ['INTEGRATED_CNC_SCHEMA.DIRECTION'])) );

  WR4:  NOT (SELF.description = 'uv') OR
        ((verify_required_action_property       (SELF, 'forward direction')) AND
         (verify_rep_item_for_action_property   (SELF, 'forward direction',
           ['INTEGRATED_CNC_SCHEMA.DIRECTION'])) AND

         (verify_required_action_property       (SELF, 'sideward direction')) AND
         (verify_rep_item_for_action_property   (SELF, 'sideward direction',
           ['INTEGRATED_CNC_SCHEMA.DIRECTION'])) );
END_ENTITY;




(* ======================================== *)
(* ACTION RESOURCE SUBTYPES *)

ENTITY machining_tool
  SUBTYPE OF (action_resource);
  WHERE
  WR1: NOT (SELF.kind.name IN ['cutting tool',
                'milling cutting tool']) OR
        (
        -- REQUIRED tool body
        (1 = SIZEOF (get_resource_property (SELF, 'tool body'))) AND

        -- must have a tool body representation
        (0 = SIZEOF (QUERY (prop <* get_resource_property (SELF, 'tool body') |
           NOT (0 < SIZEOF (QUERY (prep <* USEDIN (prop, 
                'INTEGRATED_CNC_SCHEMA.' +
                'RESOURCE_PROPERTY_REPRESENTATION.PROPERTY') |
                ('INTEGRATED_CNC_SCHEMA.MACHINING_TOOL_BODY_REPRESENTATION' 
                 IN TYPEOF(prep.representation)) )))
         ))) AND

        -- Must have at least one cutting component
        -- note that this is a set, not a list.
        (0 < SIZEOF (QUERY (arr <* USEDIN (SELF, 
          'INTEGRATED_CNC_SCHEMA.ACTION_RESOURCE_RELATIONSHIP.RELATING_RESOURCE') |
         ('INTEGRATED_CNC_SCHEMA.MACHINING_CUTTING_COMPONENT' 
          IN TYPEOF (arr.related_resource)) ))) AND

        -- OPTIONAL overall assembly length
        (1 >= SIZEOF (get_resource_property (SELF, 
           'overall assembly length'))) AND

        -- must have a resource rep with a length
        (0 = SIZEOF (QUERY (prop <* get_resource_property (SELF, 
           'overall assembly length') |
           NOT (0 < SIZEOF (QUERY (prep <* USEDIN (prop, 
                'INTEGRATED_CNC_SCHEMA.' +
                'RESOURCE_PROPERTY_REPRESENTATION.PROPERTY') |
                (0 < SIZEOF (QUERY (it <* prep.representation.items |
                 (SIZEOF([
                   'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
                   'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
                    TYPEOF(it)) = 2) ))) )))
         )))
        );

  WR2: NOT (SELF.kind.name = 'milling cutting tool') OR
        (
        -- OPTIONAL direction for spindle orientation
        (1 >= SIZEOF (get_resource_property (SELF, 
           'direction for spindle orientation'))) AND

        -- must have a resource rep with a direction
        (0 = SIZEOF (QUERY (prop <* get_resource_property (SELF, 
           'direction for spindle orientation') |
           NOT (0 < SIZEOF (QUERY (prep <* USEDIN (prop, 
                'INTEGRATED_CNC_SCHEMA.' +
                'RESOURCE_PROPERTY_REPRESENTATION.PROPERTY') |
                (0 < SIZEOF (QUERY (it <* prep.representation.items |
                 ('INTEGRATED_CNC_SCHEMA.DIRECTION' IN TYPEOF(it)) ))) )))
        ))) AND

        -- OPTIONAL tool holder diameter for spindle orientation
        (1 >= SIZEOF (get_resource_property (SELF, 
           'tool holder diameter for spindle orientation')) ) AND

        -- must have a resource rep with a length
        (0 = SIZEOF (QUERY (prop <* get_resource_property (SELF, 
           'tool holder diameter for spindle orientation') |
           NOT (0 < SIZEOF (QUERY (prep <* USEDIN (prop, 
                'INTEGRATED_CNC_SCHEMA.' +
                'RESOURCE_PROPERTY_REPRESENTATION.PROPERTY') |
                (0 < SIZEOF (QUERY (it <* prep.representation.items |
                 (SIZEOF([
                   'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
                   'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
                    TYPEOF(it)) = 2) ))) )))
         ))) 
        );
END_ENTITY;


ENTITY machining_cutting_component
  SUBTYPE OF (action_resource,characterized_object);
  WHERE
  WR1: ((1 = SIZEOF (get_resource_property (SELF, 
           'offset length'))) AND

        -- must have a resource rep with a length
        (0 = SIZEOF (QUERY (prop <* get_resource_property (SELF, 
           'offset length') |
           NOT (0 < SIZEOF (QUERY (prep <* USEDIN (prop, 
                'INTEGRATED_CNC_SCHEMA.' +
                'RESOURCE_PROPERTY_REPRESENTATION.PROPERTY') |
                (0 < SIZEOF (QUERY (it <* prep.representation.items |
                 (SIZEOF([
                   'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
                   'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
                    TYPEOF(it)) = 2) ))) )))
         ))) );

  WR2: (1 >= SIZEOF (USEDIN (SELF, 'INTEGRATED_CNC_SCHEMA.' + 
           'MATERIAL_DESIGNATION.DEFINITIONS')));

  WR3: ((1 >= SIZEOF (get_resource_property (SELF, 
           'technological data'))) AND

        -- must have a resource rep with a length
        (0 = SIZEOF (QUERY (prop <* get_resource_property (SELF, 
           'technological data') |
           NOT (0 < SIZEOF (QUERY (prep <* USEDIN (prop, 
                'INTEGRATED_CNC_SCHEMA.' +
                'RESOURCE_PROPERTY_REPRESENTATION.PROPERTY') |

                ((1 >= SIZEOF (QUERY ( it <* prep.representation.items |
                  (it.name = 'cutting angle')))) AND
                 (0 = SIZEOF (QUERY ( it <* prep.representation.items |
                  (it.name = 'cutting angle') AND NOT (SIZEOF([
                   'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
                   'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *
                    TYPEOF(it)) = 2))))
                ) AND
                ((1 >= SIZEOF (QUERY ( it <* prep.representation.items |
                  (it.name = 'free angle')))) AND
                 (0 = SIZEOF (QUERY ( it <* prep.representation.items |
                  (it.name = 'free angle') AND NOT (SIZEOF([
                   'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
                   'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *
                    TYPEOF(it)) = 2))))
                ) AND
                ((1 >= SIZEOF (QUERY ( it <* prep.representation.items |
                  (it.name = 'aux angle')))) AND
                 (0 = SIZEOF (QUERY ( it <* prep.representation.items |
                  (it.name = 'aux angle') AND NOT (SIZEOF([
                   'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
                   'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *
                    TYPEOF(it)) = 2))))
                )
            )))
         ))) );

  WR4: ((1 >= SIZEOF (get_resource_property (SELF, 
           'expected life'))) AND

        -- must have a resource rep with a length
        (0 = SIZEOF (QUERY (prop <* get_resource_property (SELF, 
           'expected life') |
           NOT (0 < SIZEOF (QUERY (prep <* USEDIN (prop, 
                'INTEGRATED_CNC_SCHEMA.' +
                'RESOURCE_PROPERTY_REPRESENTATION.PROPERTY') |
                (0 < SIZEOF (QUERY (it <* prep.representation.items |
                 (SIZEOF([
                   'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
                   'INTEGRATED_CNC_SCHEMA.TIME_MEASURE_WITH_UNIT'] *
                    TYPEOF(it)) = 2) ))) )))
         ))) );

  WR5: (1 >= SIZEOF (QUERY (arr <* USEDIN (SELF, 
          'INTEGRATED_CNC_SCHEMA.REQUIREMENT_FOR_ACTION_RESOURCE.RESOURCES') |
          (arr.kind.name = 'cutting component') AND
          (0 < SIZEOF (QUERY (mt <* arr.operations |
           'INTEGRATED_CNC_SCHEMA.MACHINING_TECHNOLOGY' IN TYPEOF (mt))))
        )));
END_ENTITY;



(* ======================================== *)
(* REPRESENTATION SUBTYPES *)


ENTITY machining_offset_vector_representation
  SUBTYPE OF (representation);
  WHERE
  WR1: (1 = SIZEOF (QUERY ( it <* SELF.items | (it.name = 'translate')))) AND
       (0 = SIZEOF (QUERY ( it <* SELF.items | (it.name = 'translate') AND NOT
         (('INTEGRATED_CNC_SCHEMA.COMPOUND_REPRESENTATION_ITEM' 
	    IN TYPEOF(it)) AND
          ('INTEGRATED_CNC_SCHEMA.LIST_REPRESENTATION_ITEM' 
	    IN TYPEOF(it.item_element)) AND
          (SIZEOF(it.item_element) = 3) AND
          (0 = SIZEOF (QUERY (ie <* it.item_element | NOT
           (('INTEGRATED_CNC_SCHEMA.EXPRESSION_REPRESENTATION_ITEM' 
	      IN TYPEOF(ie)) AND
            ('INTEGRATED_CNC_SCHEMA.NUMERIC_VARIABLE' 
	      IN TYPEOF(ie))))))
         )
        )));

  WR2: (1 >= SIZEOF (QUERY ( it <* SELF.items | (it.name = 'rotate')))) AND
       (0  = SIZEOF (QUERY ( it <* SELF.items | (it.name = 'rotate') AND NOT
         (('INTEGRATED_CNC_SCHEMA.COMPOUND_REPRESENTATION_ITEM' 
	    IN TYPEOF(it)) AND
          ('INTEGRATED_CNC_SCHEMA.LIST_REPRESENTATION_ITEM' 
	    IN TYPEOF(it.item_element)) AND
          (SIZEOF(it.item_element) = 3) AND
          (0 = SIZEOF (QUERY (ie <* it.item_element | NOT
           (('INTEGRATED_CNC_SCHEMA.EXPRESSION_REPRESENTATION_ITEM' 
	      IN TYPEOF(ie)) AND
            ('INTEGRATED_CNC_SCHEMA.NUMERIC_VARIABLE' 
	      IN TYPEOF(ie))))))
         )
        )));
END_ENTITY;



ENTITY machining_tool_body_representation
  SUBTYPE OF (representation);
  WHERE
  WR1:  NOT (SELF.name IN ['backside counterbore', 'backside countersink',
        'ball endmill', 'boring tool', 'bullnose endmill', 'centerdrill',
        'combined drill and reamer', 'combined drill and tap', 'counterbore',
        'countersink','dovetail mill', 'endmill', 'facemill', 'reamer',
        'side mill', 'spade drill', 'tap', 'tapered drill', 'tapered endmill',
        'tapered reamer', 'tapered tap', 'tee slot mill', 'thread mill',
        'threading tool', 'twist drill', 'user defined milling tool',
        'woodruff keyseat mill']) 
        OR (

        (1 = SIZEOF (QUERY (rr <* USEDIN (SELF, 
          'INTEGRATED_CNC_SCHEMA.REPRESENTATION_RELATIONSHIP.REP_1') |
         ('INTEGRATED_CNC_SCHEMA.MACHINING_TOOL_DIMENSION_REPRESENTATION'
          IN TYPEOF(rr.rep_2))))
        ) AND
        ((1 >= SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'number of teeth')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'number of teeth') AND NOT
          (('INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM' 
            IN TYPEOF(it)) AND
           ('INTEGRATED_CNC_SCHEMA.COUNT_MEASURE' 
            IN TYPEOF(it.value_component))))))
        ) AND
        ((1 >= SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'hand of cut')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'hand of cut') AND NOT
          (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
            IN TYPEOF(it)) AND
           (it.description IN ['left', 'right', 'neutral'])))))
        ) AND
        ((1 >= SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'coolant through tool')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'coolant through tool') AND NOT
          (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
            IN TYPEOF(it)) AND
           (it.description IN ['supported', 'not supported'])))))
        ) AND
        ((1 >= SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'pilot length')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'pilot length') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
        ) );

  WR2:  NOT (SELF.name = 'boring tool') OR
        ((1 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'retract movement')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'retract movement') AND NOT
          (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
            IN TYPEOF(it)) AND
           (it.description IN ['permitted', 'forbidden'])))))
        );

  WR3:  NOT (SELF.name IN ['combined drill and reamer', 
         'combined drill and tap']) OR
        ((1 >= SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'drill length')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'drill length') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
        );

  WR4:  NOT (SELF.name IN ['countersink', 'backside countersink']) OR
        ((1 >= SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'countersink radius')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'countersink radius') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
        );

  WR5:  NOT (SELF.name = 'dovetail mill') OR
        ((1 >= SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'included angle')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'included angle') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
        );

  WR6:  NOT (SELF.name IN ['side mill', 'woodruff keyseat mill']) OR
        ((1 >= SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'cutter width')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'cutter width') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
        );

  WR7:  NOT (SELF.name = 'tee slot mill') OR
        ((1 >= SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'cutting thickness')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'cutting thickness') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
        );

  WR8:  NOT (SELF.name IN ['tapered drill', 'tapered endmill',
         'tapered reamer', 'tapered tap']) OR
        ((1 >= SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'taper angle')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'taper angle') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
        );

  WR9:  NOT (SELF.name = 'user defined milling tool') OR
        ((1 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'tool identifier')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'tool identifier') AND NOT
          (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
            IN TYPEOF(it))))))
        );
END_ENTITY;



ENTITY machining_tool_dimension_representation
  SUBTYPE OF (representation);
  WHERE
  WR1:  ((1 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'diameter')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'diameter') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
        );

  WR2:  ((1 >= SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'tool top angle')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'tool top angle') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
        );

  WR3:  ((1 >= SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'tool circumference angle')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'tool circumference angle') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
        );

  WR4:  ((1 >= SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'cutting edge length')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'cutting edge length') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
        );

  WR5:  ((1 >= SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'edge radius')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'edge radius') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
        );

  WR6:  ((1 >= SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'edge center vertical')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'edge center vertical') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
        );

  WR7:  ((1 >= SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'edge center horizontal')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'edge center horizontal') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
        );

  WR8:  (0 = SIZEOF (QUERY (rr <* USEDIN (SELF, 
          'INTEGRATED_CNC_SCHEMA.REPRESENTATION_RELATIONSHIP.REP_2') |
         ('INTEGRATED_CNC_SCHEMA.MACHINING_TOOL_BODY_REPRESENTATION'
          IN TYPEOF(rr.rep_1)) AND (rr.rep_1.name = 'ball endmill')))
        ) OR (verify_ball_endmill_edge_dimensions (SELF));


  WR9:  (0 = SIZEOF (QUERY (rr <* USEDIN (SELF, 
          'INTEGRATED_CNC_SCHEMA.REPRESENTATION_RELATIONSHIP.REP_2') |
         ('INTEGRATED_CNC_SCHEMA.MACHINING_TOOL_BODY_REPRESENTATION'
          IN TYPEOF(rr.rep_1)) AND 
         (rr.rep_1.name IN ['bullnose endmill', 'ball endmill'])))
        ) OR (
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'tool top angle') AND NOT 
          (it.value_component = 0)))
         ) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'tool circumference angle') AND NOT 
          (it.value_component = 0)))
         )
        );
END_ENTITY;



ENTITY machining_tool_direction_representation
  SUBTYPE OF (representation);
  WHERE
  WR1:  (SELF.name IN ['two axes', 'three axes', 'three axes tilted tool',
        'five axes const tilt yaw', 'five axes var tilt yaw']);

  WR2:  NOT (SELF.name = 'three axes tilted tool') OR
        ((1 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'tool direction orientation')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'tool direction orientation') AND NOT
          ('INTEGRATED_CNC_SCHEMA.DIRECTION' IN TYPEOF(it)))))
        );

  WR3:  NOT (SELF.name = 'five axes const tilt yaw') OR
        ((1 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'tool direction tilt angle')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'tool direction tilt angle') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2)))) AND
         (1 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'tool direction yaw angle')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'tool direction yaw angle') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
         );
END_ENTITY;



ENTITY machining_toolpath_speed_profile_representation
  SUBTYPE OF (representation);
END_ENTITY;



ENTITY freeform_milling_tolerance_representation
  SUBTYPE OF (representation);
  WHERE
  WR1:  ((1 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'chordal tolerance')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'chordal tolerance') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
        );
  WR2:  ((1 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'scallop height')))) AND
         (0 = SIZEOF (QUERY ( it <* SELF.items |
          (it.name = 'scallop height') AND NOT (SIZEOF([
           'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
           'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
            TYPEOF(it)) = 2))))
        );
END_ENTITY;



(* Brings in the PLIB Part 20 expressions for use in properties *)
ENTITY expression_representation_item
  SUBTYPE OF (representation_item, generic_expression);
END_ENTITY;


FUNCTION get_action_property (
        cad:            characterized_action_definition;
        prop_name:      STRING
        ): SET OF action_property;

    RETURN (bag_to_set (QUERY (ap <*
        USEDIN (cad, 'INTEGRATED_CNC_SCHEMA.ACTION_PROPERTY.DEFINITION') |
        (ap.name = prop_name))));
END_FUNCTION;


FUNCTION get_resource_property (
        crd:            characterized_resource_definition;
        prop_name:      STRING
        ): SET OF resource_property;

    RETURN (bag_to_set (QUERY (rp <*
        USEDIN (crd, 'INTEGRATED_CNC_SCHEMA.RESOURCE_PROPERTY.RESOURCE') |
        (rp.name = prop_name))));
END_FUNCTION;



FUNCTION get_relating_amr (am: action_method)
        : SET OF action_method_relationship;

    RETURN (bag_to_set (USEDIN (am,
       'INTEGRATED_CNC_SCHEMA.ACTION_METHOD_RELATIONSHIP.RELATING_METHOD')));
END_FUNCTION;


(* NOT USED AT THE MOMENT
FUNCTION get_related_amr (am: action_method)
        : SET OF action_method_relationship;

    RETURN (bag_to_set (USEDIN (am,
       'INTEGRATED_CNC_SCHEMA.ACTION_METHOD_RELATIONSHIP.RELATED_METHOD')));
END_FUNCTION;
*)

FUNCTION verify_optional_relating_amr (
        am:             action_method;
        rel_name:       STRING
        ): LOGICAL;

    RETURN (1 >= SIZEOF (QUERY (amr <* get_relating_amr (am) | 
                amr.name = rel_name)));
END_FUNCTION;

FUNCTION verify_required_relating_amr (
        am:             action_method;
        rel_name:       STRING
        ): LOGICAL;

    RETURN (1 = SIZEOF (QUERY (amr <* get_relating_amr (am) | 
                amr.name = rel_name)));
END_FUNCTION;


FUNCTION verify_related_type_for_amr (
        am:             action_method;
        rel_name:       STRING;
        types:          SET OF STRING
        ): LOGICAL;

    RETURN  (0 = SIZEOF (QUERY (amr <* get_relating_amr (am) |
            (amr.name = rel_name) AND NOT 
            (SIZEOF(types * TYPEOF(amr.related_method)) = SIZEOF(types))
        )));
END_FUNCTION;


FUNCTION verify_optional_action_property (
        cad:            characterized_action_definition;
        prop_name:      STRING
        ): LOGICAL;

    RETURN (1 >= SIZEOF (get_action_property (cad, prop_name)));
END_FUNCTION;

FUNCTION verify_required_action_property (
        cad:            characterized_action_definition;
        prop_name:      STRING
        ): LOGICAL;

    RETURN (1 = SIZEOF (get_action_property (cad, prop_name)));
END_FUNCTION;



FUNCTION verify_rep_item_for_action_property (
        cad:            characterized_action_definition;
        prop_name:      STRING;
        prop_types:     SET OF STRING
        ): LOGICAL;

    -- All properties have matching representations.  The reason we test
    -- for "nothing matching the negation" rather than "something matching
    -- the positive" is so that we return true if there are no properties.
    --
    RETURN (0 = SIZEOF (QUERY (prop <* get_action_property (cad, prop_name) |

        -- property has no matching representations
        NOT (

        -- there is at least one rep with matching rep items
        (0 < SIZEOF (QUERY (prep <* USEDIN (prop, 'INTEGRATED_CNC_SCHEMA.' +
                'ACTION_PROPERTY_REPRESENTATION.PROPERTY') |

           -- property representation has at least one matching rep item
           (0 < SIZEOF (QUERY (it <* prep.representation.items |
               (SIZEOF(prop_types * TYPEOF(it)) = SIZEOF(prop_types))))
           )))
        ))
    )));
END_FUNCTION;

FUNCTION verify_length_measure_action_property (
        cad:            characterized_action_definition;
        prop_name:      STRING
        ): LOGICAL;

    RETURN (verify_rep_item_for_action_property (cad, prop_name,
        ['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
         'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT']));
END_FUNCTION;


FUNCTION verify_ratio_measure_action_property (
        cad:            characterized_action_definition;
        prop_name:      STRING
        ): LOGICAL;

    RETURN (verify_rep_item_for_action_property (cad, prop_name,
        ['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
         'INTEGRATED_CNC_SCHEMA.RATIO_MEASURE_WITH_UNIT']));
END_FUNCTION;


FUNCTION verify_angle_measure_action_property (
        cad:            characterized_action_definition;
        prop_name:      STRING
        ): LOGICAL;

    RETURN (verify_rep_item_for_action_property(cad, prop_name,
        ['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
         'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT']));
END_FUNCTION;


FUNCTION verify_time_measure_action_property (
        cad:            characterized_action_definition;
        prop_name:      STRING
        ): LOGICAL;

    RETURN (verify_rep_item_for_action_property(cad, prop_name,
        ['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
         'INTEGRATED_CNC_SCHEMA.TIME_MEASURE_WITH_UNIT']));
END_FUNCTION;


FUNCTION verify_descriptive_action_property (
        cad:            characterized_action_definition;
        prop_name:      STRING
        ): LOGICAL;

    RETURN (verify_rep_item_for_action_property(cad, prop_name,
        ['INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM']));
END_FUNCTION;



FUNCTION verify_parameter_action_property (
        cad:            characterized_action_definition;
        prop_name:      STRING
        ): LOGICAL;

    -- All properties have matching representations.  The reason we test
    -- for "nothing matching the negation" rather than "something matching
    -- the positive" is so that we return true if there are no properties.
    --
    RETURN (0 = SIZEOF (QUERY (prop <* get_action_property (cad, prop_name) |

        -- property has no matching representations
        NOT (

        -- there is at least one rep with matching rep items
        (0 < SIZEOF (QUERY (prep <* USEDIN (prop, 'INTEGRATED_CNC_SCHEMA.' +
                'ACTION_PROPERTY_REPRESENTATION.PROPERTY') |

           -- property representation has at least one matching rep item
           (0 < SIZEOF (QUERY (it <* prep.representation.items |
               (('INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM' 
                  IN TYPEOF(it)) AND
                ('INTEGRATED_CNC_SCHEMA.PARAMETER_VALUE' 
                  IN TYPEOF(it.value_component)))
           )))
        )))
    ))));
END_FUNCTION;


FUNCTION verify_enumeration_action_property (
        cad:            characterized_action_definition;
        prop_name:      STRING;
        prop_values:    SET OF STRING
        ): LOGICAL;

    -- Each action property has at least one representation that contains
    -- a descriptive rep item, and that descriptive rep item has a value
    -- drawn from the prop_values set.

    -- there are no properties that do not have matching representations
    RETURN (0 = SIZEOF (QUERY (prop <* get_action_property (cad, prop_name) |

        NOT (
        -- there is at least one rep with matching rep items
        (0 < SIZEOF (QUERY (prep <* USEDIN (prop, 'INTEGRATED_CNC_SCHEMA.' +
                'ACTION_PROPERTY_REPRESENTATION.PROPERTY') |

           -- property representation has at least one matching rep item
           (0 < SIZEOF (QUERY (it <* prep.representation.items |
               (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
                  IN TYPEOF(it)) AND
                (it.description IN prop_values))
           )))
        )))
    ))));
END_FUNCTION;



--- MORE COMPLEX CONSTRAINTS

--- MORE COMPLEX CONSTRAINTS

--- MORE COMPLEX CONSTRAINTS

--- MORE COMPLEX CONSTRAINTS

FUNCTION verify_ball_endmill_edge_dimensions (
        rep:            machining_tool_dimension_representation
        ): LOGICAL;

    LOCAL
      diameter : length_measure;
      dia_items : SET OF REPRESENTATION_ITEM := 
        QUERY (it <* rep.items | (it.name = 'diameter'));
    END_LOCAL;

    diameter := dia_items[1].value_component;

    RETURN
         ((0 = SIZEOF (QUERY ( it <* rep.items |
           (it.name = 'edge center horizontal') AND NOT 
           (it.value_component = 0))))
          AND
          (0 = SIZEOF (QUERY ( it <* rep.items |
           (it.name = 'edge center vertical') AND NOT 
           (it.value_component = diameter/2))))
          AND
          (0 = SIZEOF (QUERY ( it <* rep.items |
           (it.name = 'edge radius') AND NOT 
           (it.value_component = diameter/2))))
          );
END_FUNCTION;



FUNCTION verify_optional_in_process_geometry (
        mpe:            machining_process_executable
        ): LOGICAL;

    RETURN 
      ((verify_optional_action_property (mpe, 'as-is shape')) AND
       (verify_optional_action_property (mpe, 'to-be shape')) AND
       (verify_optional_action_property (mpe, 'removal shape')) AND

        -- All properties need advanced brep shape reps
       (0 = SIZEOF (QUERY (prop <* 
         USEDIN (mpe, 'INTEGRATED_CNC_SCHEMA.ACTION_PROPERTY.DEFINITION') |
         ((prop.name IN ['as-is shape', 'to-be shape', 'removal shape']) AND 
          (0 = SIZEOF (QUERY (prep <* USEDIN (prop, 'INTEGRATED_CNC_SCHEMA.' +
             'ACTION_PROPERTY_REPRESENTATION.PROPERTY') |
             ('INTEGRATED_CNC_SCHEMA.ADVANCED_BREP_SHAPE_REPRESENTATION' 
               IN TYPEOF (prep.representation))))))
          )))
      );
END_FUNCTION;


(* ========================================  *)
(* Value range and surface texture things from AP 214 *)

ENTITY value_range
  SUBTYPE OF (compound_representation_item);
END_ENTITY;  -- 10303-214: automotive_design 

ENTITY surface_texture_representation
  SUBTYPE OF (representation);
END_ENTITY;  -- 10303-214: automotive_design 




(* ========================================  *)
(* Feature definitions imported verbatim from AP-224 *)

ENTITY applied_area
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE'
	 IN TYPEOF(SELF.of_shape));
    WR2: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
     'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0);
    WR3: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
     'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | ((
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') IN TYPEOF(pdr.
	 used_representation)) ) |  
	 (NOT({2 <= SIZEOF(impl_rep.used_representation.items) <= 3} )
	  ) )) = 0)) )) = 0);
    WR4: SIZEOF( QUERY( pd <* USEDIN( SELF, 
	'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	(SIZEOF( QUERY( pdr <* USEDIN( pd, 
	'INTEGRATED_CNC_SCHEMA.' + 
	'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	('INTEGRATED_CNC_SCHEMA.' + 
	'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	IN TYPEOF(pdr.used_representation)) AND
	(SIZEOF( QUERY( srwp_i <* pdr.used_representation.items |
	NOT (srwp_i.name IN ['orientation','effective length', 
	'maximum length']) )) > 0 ) )) = 0 )   )) = 0;
    WR5: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
     'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
       (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
       TYPEOF(it)) = 2) AND (it.name = 'effective length')) )) = 1)) )) 
	 = 0)) )) <= 1);
    WR6: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
     'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	(NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	TYPEOF(it)) = 2) AND (it.name = 'maximum length')) )) <= 1)) )) 
	 = 0)) )) = 0);
    WR7: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
     'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	(NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 (('INTEGRATED_CNC_SCHEMA.PLACEMENT' 
	 IN TYPEOF(it))	 AND (it.name = 'orientation')) )) = 1)) )) 
	 = 0)) )) = 0);
END_ENTITY; -- applied_area


ENTITY block_shape_representation
  SUBTYPE OF (shape_representation_with_parameters);
  WHERE
    WR1: (SIZEOF(SELF.items) = 4);
    WR2: (SIZEOF(QUERY ( it <* SELF.items | 
	 (('INTEGRATED_CNC_SCHEMA.PLACEMENT' 
	 IN TYPEOF(it)) AND (it.name = 'orientation')) )) = 1);
    WR3: (SIZEOF(QUERY ( it <* SELF.items | 
	 ((SIZEOF(
	 ['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	  TYPEOF(it)) = 2) AND (it.name = 'length')) )) = 1);
    WR4: (SIZEOF(QUERY ( it <* SELF.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'width')) )) = 1);
    WR5: (SIZEOF(QUERY ( it <* SELF.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'height')) )) = 1);
END_ENTITY; -- block_shape_representation


ENTITY boss
  SUBTYPE OF (feature_definition);
  WHERE	  
    WR1: SELF\characterized_object.description IN 
	 ['circular', 'complex', 'rectangular'];
    WR2: SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' IN
	 TYPEOF (pd)) |
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'boss height occurrence') AND
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'path feature component usage') AND 
	 ('INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_DEFINING_RELATIONSHIP' IN TYPEOF (sar))) |
	 ('INTEGRATED_CNC_SCHEMA.PATH_FEATURE_COMPONENT' IN
	 TYPEOF (sdr.relating_shape_aspect)) AND
	 (sdr.relating_shape_aspect.description = 'linear') AND
	 (sdr.name = 'boss height'))) = 1))) = 1))) = 0; 
    WR3: SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	  SIZEOF( QUERY( pdr <* USEDIN( pd, 
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) AND
	({1 <= SIZEOF(pdr.used_representation.items) <= 2} ) )) = 1 )) = 1;
    WR4: SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd, 
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' IN
	 TYPEOF(pdr.used_representation)) AND
	 (SIZEOF( QUERY( srwp_i <* pdr.used_representation.items |
	 (srwp_i.name = 'orientation') OR
	 (srwp_i.name = 'fillet radius'))) 
	 = SIZEOF(pdr.used_representation.items)) )) = 1 )) = 1;
    WR5: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF (
	 ['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] * 
	 TYPEOF (it)) = 2) AND (it.name = 'fillet radius'))) <= 1))) 
	 = 0))) = 0;
    WR6: (NOT (SELF\characterized_object.description = 'circular')) OR
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) |
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'circular profile occurrence') AND
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'profile usage') AND 
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 'INTEGRATED_CNC_SCHEMA.CIRCULAR_CLOSED_PROFILE' 
	 IN TYPEOF (sdr.relating_shape_aspect))) = 1))) = 1))) = 0);
    WR7: SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' IN
	 TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'top condition occurrence') AND
	 (SIZEOF (QUERY (fcr <* QUERY (sar <* USEDIN (sa_occ, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'boss top usage') AND
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF (sar))) |'INTEGRATED_CNC_SCHEMA.BOSS_TOP' 
	 IN TYPEOF (fcr.relating_shape_aspect))) = 1))) = 1))) = 0;
    WR8: (NOT (SELF\characterized_object.description = 'circular')) OR
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' IN
	 TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'change in diameter occurrence') AND
	 (SIZEOF (QUERY (fcr <* QUERY (sar <* USEDIN (sa_occ, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'taper usage') AND
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF (sar))) | 'INTEGRATED_CNC_SCHEMA.TAPER' 
	 IN TYPEOF (fcr.related_shape_aspect)) )= 1))) <= 1))) = 0);
    WR9: (NOT (SELF\characterized_object.description = 'complex')) OR
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' IN
	 TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'enclosed boundary occurrence') AND
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'profile usage') AND
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 SIZEOF (['INTEGRATED_CNC_SCHEMA.NGON_CLOSED_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.CLOSED_PATH_PROFILE'] *	 
	 TYPEOF (sdr.relating_shape_aspect)) = 1)) = 1)))= 1))) = 0);
    WR10: (NOT (SELF\characterized_object.description 
	 IN ['complex','rectangular'])) OR
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'change in boundary occurrence') AND
	 (SIZEOF (QUERY (fcr <* QUERY (sar <* USEDIN (sa_occ, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATING_SHAPE_ASPECT') |
	 (sar.description = 'taper usage') AND
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 ('INTEGRATED_CNC_SCHEMA.TAPER' 
	 IN TYPEOF (fcr.related_shape_aspect)) AND
	 (fcr.related_shape_aspect.description IN 
	 ['angle taper','directed taper']))) 
	 = 1))) <= 1))) = 0);
    WR11: (NOT (SELF\characterized_object.description = 'rectangular')) OR
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) |
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'rectangular profile occurrence') AND
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'profile usage') AND 
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 'INTEGRATED_CNC_SCHEMA.RECTANGULAR_CLOSED_PROFILE' 
	 IN TYPEOF (sdr.relating_shape_aspect))) = 1))) = 1))) = 0);
END_ENTITY;  -- boss

ENTITY boss_top
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	  IN TYPEOF(SELF.of_shape.definition));
    WR2: (SELF.description IN ['planar','complex']);
    WR3: ((NOT (SELF.description = 'planar')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
       (('INTEGRATED_CNC_SCHEMA.DIRECTION_SHAPE_REPRESENTATION') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0));
    WR4: ((NOT (SELF.description = 'planar')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	(('INTEGRATED_CNC_SCHEMA.LOCATION_SHAPE_REPRESENTATION') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0));
    WR5: (NOT (SELF.description = 'complex')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.'+
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.FACE_SHAPE_REPRESENTATION') 
	 IN TYPEOF(pdr.used_representation) )) = 1)) )) = 0);
    WR6: (SIZEOF(QUERY ( fcr <* QUERY ( sar <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.'  + 
	 'RELATING_SHAPE_ASPECT') | 
	 ((sar.description = 'boss top usage') AND
	 (sar.name  IN ['boss height start','boss height end']))AND
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(sar)))  | 
	 ((fcr.related_shape_aspect.description = 
	 'top condition occurrence') AND 
	 ('INTEGRATED_CNC_SCHEMA.BOSS' 
	 IN TYPEOF(fcr.related_shape_aspect.of_shape.definition))) )) 
	 >= 1);
    WR7: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |  
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) )) <= 1)) )) = 0);
    WR8: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 1)) )) 
	 = 0)) )) = 0);
    WR9: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF (
	 ['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] * 
	 TYPEOF (it)) = 2) AND (it.name = 'top radius'))) <= 1))) 
	 = 0))) = 0;
END_ENTITY; -- boss_top 

ENTITY chamfer
  SUBTYPE OF (transition_feature);
  WHERE
    WR1: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
       'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.FACE_SHAPE_REPRESENTATION' 
	 IN TYPEOF(pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'chamfer face')) )) = 1)) )) = 0);
    WR2: (SIZEOF(QUERY ( fcr <* QUERY ( sar <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATING_SHAPE_ASPECT') |
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(sar)) ) | 
	 (('INTEGRATED_CNC_SCHEMA.CHAMFER_OFFSET' 
	 IN TYPEOF(fcr.related_shape_aspect)) AND 
	 (fcr.related_shape_aspect.description = 'first offset')) )) = 1);
    WR3: (SIZEOF(QUERY ( fcr <* QUERY ( sar <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATING_SHAPE_ASPECT') |
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(sar)) ) | 
	 (('INTEGRATED_CNC_SCHEMA.CHAMFER_OFFSET' 
	 IN TYPEOF(fcr.related_shape_aspect)) AND 
	 (fcr.related_shape_aspect.description = 'second offset')) )) = 1);
END_ENTITY; -- chamfer

ENTITY chamfer_offset
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: (SELF.description IN ['first offset','second offset']);
    WR2: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0);
    WR3: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 1)) )) 
	 = 0)) )) = 0);
    WR4: ((NOT (SELF.description = 'first offset')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'offset amount')) )) = 1)) )) 
	 = 0)) )) = 0));
    WR5: ((NOT (SELF.description = 'first offset')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |  
	 (('INTEGRATED_CNC_SCHEMA.FACE_SHAPE_REPRESENTATION' 
	 IN TYPEOF(pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'first face shape')) )) = 1)) )) 
	 = 0));
    WR6: ((NOT (SELF.description = 'second offset')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 (((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'offset amount')) OR 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] 
	 * TYPEOF(it)) = 2) AND (it.name = 'offset angle'))) )) = 1)) )) 
	 = 0)) )) = 0));
    WR7: ((NOT (SELF.description = 'second offset')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |	   
	 (('INTEGRATED_CNC_SCHEMA.FACE_SHAPE_REPRESENTATION' 
	 IN TYPEOF(pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'second face shape')) )) = 1)) )) 
	 = 0));
    WR8: (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' + 
	 'RELATED_SHAPE_ASPECT') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'FEATURE_COMPONENT_RELATIONSHIP') 
	 IN TYPEOF(sar)) ) | 
	 ('INTEGRATED_CNC_SCHEMA.CHAMFER' 
	 IN TYPEOF(sdr.relating_shape_aspect)) )) = 1);
END_ENTITY; -- chamfer_offset

ENTITY circular_closed_profile
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF(SELF.of_shape.definition));
    WR2: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0);
    WR3: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | ((
	 'INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS')
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 2)) )) 
	 = 0)) )) = 0);
    WR4: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 NOT(SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 (('INTEGRATED_CNC_SCHEMA.PLACEMENT' 
	 IN TYPEOF(it)) 
	 AND (it.name = 'orientation')) )) = 1) )) = 0)) )) = 0);
    WR5: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'diameter')) )) = 1)) )) 
	 =  0)) )) = 0);
END_ENTITY; -- circular_closed_profile

ENTITY circular_pattern
  SUBTYPE OF (replicate_feature);
  WHERE
    WR1: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN
	 (pds,'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' 
	 + 'RELATING_SHAPE_ASPECT') | 
	 ((('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT' 
	 IN TYPEOF(sdr.related_shape_aspect)) )) = 1)) )) <= 3)) )) = 0);
    WR2: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0);
    WR3: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT ((SIZEOF (impl_rep.used_representation.items) >= 3)  
	 AND (SIZEOF(impl_rep.used_representation.items) <= 5))) )) 
	 = 0)) )) = 0);
    WR4: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF(
	 ['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'diameter')) )) <= 1)) )) 
	 = 0)) )) = 0);
    WR5: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF(
	 ['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] * 
	 TYPEOF(it)) = 2) AND (it.name = 'base feature rotation')) )) 
	 <= 1)) )) = 0)) )) = 0);
    WR6: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND 
	 ('INTEGRATED_CNC_SCHEMA.COUNT_MEASURE' 
	 IN TYPEOF(it\measure_with_unit.value_component)) AND 
	 (it.name = 'number of features')) )) = 1)) )) = 0)) )) = 0);
    WR7: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF(
	 ['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] * 
	 TYPEOF(it)) = 2) AND (it.name = 'angular spacing'))))= 1)) )) 
	 = 0)) )) = 0);
    WR8: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 (('INTEGRATED_CNC_SCHEMA.PLACEMENT' 
	 IN TYPEOF(it)) AND (it.name = 'orientation')) )) = 1)) )) 
	 = 0)) )) = 0);
END_ENTITY; -- circular_pattern


ENTITY closed_path_profile
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF(SELF.of_shape.definition));
    WR2: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.' + 
	 'DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0);
    WR3: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 1)) )) 
	 = 0)) )) = 0);
    WR4: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 (('INTEGRATED_CNC_SCHEMA.PLACEMENT' 
	 IN TYPEOF(it)) AND (it.name = 'orientation')) )) = 1)) )) 
	 = 0)) )) = 0);
    WR5: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.' + 
	 'DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.PATH_SHAPE_REPRESENTATION') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0);
END_ENTITY; -- closed_path_profile


ENTITY composite_hole
  SUBTYPE OF (compound_feature);
  WHERE
    WR1: (SELF\characterized_object.description 
	 IN ['counterbore', 'countersunk']);
    WR2: (SIZEOF (QUERY (pds <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION')|
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pds)) AND 
	 (SIZEOF (QUERY (csa <* USEDIN (pds, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE')| 
	 ('INTEGRATED_CNC_SCHEMA.COMPOSITE_SHAPE_ASPECT' 
	 IN TYPEOF (csa)) AND 
	 (SIZEOF (QUERY (sar <*	 csa.component_relationships |
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(sar)) AND
	 ('INTEGRATED_CNC_SCHEMA.ROUND_HOLE' 
	 IN TYPEOF (sar.related_shape_aspect))	)) = 2)	 )) = 1) )) = 1); 
    WR3: (NOT (SELF\characterized_object.description = 'countersunk')) OR
	 (SIZEOF (QUERY (pds <* USEDIN (SELF,
	'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION')|
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pds)) AND 
	 (SIZEOF (QUERY (csa <* USEDIN (pds, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE')| 
	 ('INTEGRATED_CNC_SCHEMA.COMPOSITE_SHAPE_ASPECT' 
	 IN TYPEOF (csa)) AND 
	 (SIZEOF (QUERY (sar <*	 csa.component_relationships |
	 ('INTEGRATED_CNC_SCHEMA.ROUND_HOLE' 
	 IN TYPEOF (sar.related_shape_aspect)) 
	 AND
	 NOT(SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN
	 (sar.related_shape_aspect,
       'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE'  
	 IN TYPEOF(pd)) ) | 
	 (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'change in diameter occurrence')  AND 
	 (SIZEOF(QUERY ( fcr2 <* QUERY ( sar2 <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' + 
	 'RELATING_SHAPE_ASPECT') | 
	 ((sar2.description = 'taper usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP') 
	 IN TYPEOF(sar2))) ) | 
	 ('INTEGRATED_CNC_SCHEMA.TAPER' 
	 IN TYPEOF(fcr2.related_shape_aspect)) )) = 1)) )) = 0)) )) = 0) 
	 )) = 1)  )) = 1) )) = 1); 
END_ENTITY; -- composite_hole



ENTITY compound_feature
  SUBTYPE OF (feature_definition);
  WHERE 
    WR1: SIZEOF( QUERY( pds <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	  IN TYPEOF(pds))  AND
	 (SIZEOF( QUERY( csa <* USEDIN( pds, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 ((csa.name='compound feature in solid') AND
	 ('INTEGRATED_CNC_SCHEMA.COMPOSITE_SHAPE_ASPECT' 
	 IN TYPEOF(csa))) )) = 1)  )) = 1;
    WR2: SIZEOF( QUERY( pds <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	  IN TYPEOF(pds))  AND
	 (SIZEOF( QUERY( csa <* USEDIN( pds, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 'INTEGRATED_CNC_SCHEMA.COMPOSITE_SHAPE_ASPECT' 
	 IN TYPEOF(csa) )) = 1)	 )) = 1; 
    WR3: (SIZEOF(QUERY ( pds <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pds)) AND (SIZEOF(QUERY ( csa <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 (('INTEGRATED_CNC_SCHEMA.COMPOSITE_SHAPE_ASPECT' 
	 IN TYPEOF(csa)) AND 
	 (SIZEOF(QUERY ( fcr <* csa.component_relationships | 
	 (NOT ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(fcr))) )) = 0)) )) = 1)) )) = 1);
    WR4: SIZEOF (QUERY (pds <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION')|
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pds)) AND 
	 (SIZEOF (QUERY (csa <* USEDIN (pds, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE')| 
	 ('INTEGRATED_CNC_SCHEMA.COMPOSITE_SHAPE_ASPECT' 
	 IN TYPEOF (csa)) AND 
	 (SIZEOF (QUERY (sar <*	 csa.component_relationships |
	 (SIZEOF ([
	 'INTEGRATED_CNC_SCHEMA.INSTANCED_FEATURE', 
	 'INTEGRATED_CNC_SCHEMA.TRANSITION_FEATURE', 
	 'INTEGRATED_CNC_SCHEMA.APPLIED_AREA'] *
	 TYPEOF (sar.related_shape_aspect)) = 1) )) = 2)  )) = 1) )) = 1; 
    WR5: (SIZEOF(QUERY ( pds <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pds)) AND 
	 (SIZEOF(QUERY ( csa <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 (('INTEGRATED_CNC_SCHEMA.COMPOSITE_SHAPE_ASPECT' 
	 IN TYPEOF(csa)) AND 
	 (SIZEOF(QUERY ( sar <* csa.component_relationships | 
	 ('INTEGRATED_CNC_SCHEMA.THREAD' 
	 IN TYPEOF(sar.related_shape_aspect)) )) = 0)
	 ) )) = 1)) )) = 1);
    WR6: (SIZEOF (QUERY (pds <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION')|
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pds)) AND	(SIZEOF (QUERY (csa <* USEDIN (pds, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE')|
	 ('INTEGRATED_CNC_SCHEMA.COMPOSITE_SHAPE_ASPECT' 
	 IN TYPEOF (csa))  AND 
	 (SIZEOF (QUERY (sar <*	 csa.component_relationships |
	 (('INTEGRATED_CNC_SCHEMA.COMPOUND_FEATURE' 
	 IN TYPEOF (sar.related_shape_aspect))	AND
	 (sar.related_shape_aspect\characterized_object.name <> 
	 SELF\characterized_object.name)) )) = 0)  )) = 1) )) = 1); 
END_ENTITY;  -- compound_feature


ENTITY cylindrical_shape_representation
  SUBTYPE OF (shape_representation_with_parameters);
  WHERE
    WR1: (SIZEOF(SELF.items) = 3);
    WR2: (SIZEOF(QUERY ( it <* SELF.items | ((
	 'INTEGRATED_CNC_SCHEMA.PLACEMENT' 
	 IN TYPEOF(it)) AND (it.name = 'orientation')) )) = 1);
    WR3: (SIZEOF(QUERY ( it <* SELF.items | ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	  TYPEOF(it)) = 2) AND (it.name = 'length')) )) = 1);
    WR4: (SIZEOF(QUERY ( it <* SELF.items | ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	  TYPEOF(it)) = 2) AND (it.name = 'diameter')) )) = 1);
END_ENTITY; -- cylindrical_shape_representation


ENTITY direction_shape_representation
  SUBTYPE OF (shape_representation);
  WHERE
    WR1: (SIZEOF(SELF.items) = 1);
    WR2: (SIZEOF(QUERY ( it <* SELF.items | 
	 (NOT (
	 'INTEGRATED_CNC_SCHEMA.DIRECTION' IN TYPEOF(it))) )) 
	 = 0);
END_ENTITY; -- direction_shape_representation


ENTITY document_file
  SUBTYPE OF (characterized_object, document);
  WHERE
    WR1: (SIZEOF(QUERY(adr<* QUERY(dr <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.DOCUMENT_REFERENCE.ASSIGNED_DOCUMENT') |
	 'INTEGRATED_CNC_SCHEMA.APPLIED_DOCUMENT_REFERENCE'
	 IN TYPEOF(dr))|
	'INTEGRATED_CNC_SCHEMA.EXTERNALLY_DEFINED_FEATURE_DEFINITION'
	 IN TYPEOF(adr.items)
	 ))=1) OR 
	 (SIZEOF(QUERY (duc <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.DOCUMENT_USAGE_CONSTRAINT.SOURCE') |
	 NOT 
	 (SIZEOF(QUERY(aduc<* QUERY(duca <* USEDIN(duc,
	 'INTEGRATED_CNC_SCHEMA.DOCUMENT_USAGE_CONSTRAINT_ASSIGNMENT.'+
	 'ASSIGNED_DOCUMENT_USAGE') |
	 'INTEGRATED_CNC_SCHEMA.'+
	 'APPLIED_DOCUMENT_USAGE_CONSTRAINT_ASSIGNMENT'
	 IN TYPEOF(duca))|
	'INTEGRATED_CNC_SCHEMA.EXTERNALLY_DEFINED_FEATURE_DEFINITION'
	 IN TYPEOF(aduc.items)
	 ))=1))) = 0);

    WR2: (SIZEOF(QUERY(drt <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.'+
	 'DOCUMENT_REPRESENTATION_TYPE.REPRESENTED_DOCUMENT') |
	 (drt.name='physical')))=1);
END_ENTITY; -- document_file


ENTITY edge_round
  SUBTYPE OF (transition_feature);
  WHERE
    WR1: (NOT (SELF\shape_aspect.description = 'constant radius')) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <*  USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	'INTEGRATED_CNC_SCHEMA.SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF (pdr.used_representation))) = 1))) = 0);
    WR2: (NOT (SELF\shape_aspect.description = 'constant radius')) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	'INTEGRATED_CNC_SCHEMA.SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 (NOT (SIZEOF (impl_rep.used_representation.items) >= 1)
	 AND  (SIZEOF (impl_rep.used_representation.items) <= 3)))) 
	 = 0))) = 0); 
    WR3: (NOT (SELF.description = 'constant radius')) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	'INTEGRATED_CNC_SCHEMA.SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] * 
	 TYPEOF (it)) = 2) AND (it.name = 'radius'))) = 1))) = 0))) = 0);
    WR4: (NOT (SELF.description = 'constant radius')) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	'INTEGRATED_CNC_SCHEMA.SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] * 
	 TYPEOF (it)) = 2) AND (it.name = 'first offset'))) <= 1))) 
	 = 0))) = 0);
    WR5: (NOT (SELF.description = 'constant radius')) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	'INTEGRATED_CNC_SCHEMA.SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] * 
	 TYPEOF (it)) = 2) AND (it.name = 'second offset'))) <= 1))) 
	 = 0))) = 0);
    WR6: SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.FACE_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'edge round face'))) = 1))) = 0; 
    WR7: SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.FACE_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'first face shape'))) = 1))) = 0;
    WR8: SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.FACE_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'second face shape'))) = 1))) = 0;
END_ENTITY; -- edge_round



ENTITY externally_defined_feature_definition
  SUBTYPE OF (feature_definition, externally_defined_item);
  WHERE
    WR1: (((SELF\characterized_object.description = 'thread') AND 
	 (SELF\externally_defined_item.item_id='external thread') AND 
	 (SELF\externally_defined_item.source.source_id=
	       'external feature specification') ) OR 
	 ((SELF\characterized_object.description = 'marking') AND 
	 (SELF\externally_defined_item.item_id='external marking') AND 
	 (SELF\externally_defined_item.source.source_id=
	      'external feature specification')) OR 
	 ((SELF\characterized_object.description = 'knurl') AND 
	 (SELF\externally_defined_item.item_id='external knurl') AND  
	 (SELF\externally_defined_item.source.source_id=
	      'external feature specification')));
    WR2: ((NOT (SELF\characterized_object.description = 'thread')) OR 
	 (SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd, 
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) AND
	 ({8 <= SIZEOF(pdr.used_representation.items) <= 10} ) )) 
	 = 1  )) = 1));
    WR3: ((NOT (SELF\characterized_object.description = 'marking')) OR 
	 (SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd, 
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) AND
	 (SIZEOF(pdr.used_representation.items) = 2)  )) = 1  )) = 1));
    WR4: ((NOT (SELF\characterized_object.description = 'knurl')) OR 
	 (SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd, 
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) AND
	 (SIZEOF(pdr.used_representation.items) = 1)   )) = 1  )) = 1));
    WR5: (NOT (SELF\characterized_object.description IN [ 'knurl',
	 'thread'])) OR
	 (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN
	 (pds,'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'partial area occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' 
	 + 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'applied area usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 ('INTEGRATED_CNC_SCHEMA.APPLIED_AREA' 
	 IN TYPEOF(sdr.relating_shape_aspect)) )) = 1)) )) <= 1)) )) = 0);
    WR6: (NOT (SIZEOF(QUERY( doc <*(QUERY( adr <*USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.APPLIED_DOCUMENT_REFERENCE.ITEMS') |
	 'INTEGRATED_CNC_SCHEMA.DOCUMENT'
	  IN TYPEOF (adr.assigned_document) )) |
	 'INTEGRATED_CNC_SCHEMA.DOCUMENT_FILE' IN TYPEOF(doc) ))
	  =1) OR 
	  NOT (SIZEOF(QUERY( doc <*(QUERY( aduc <*USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.'+
	 'APPLIED_DOCUMENT_USAGE_CONSTRAINT_ASSIGNMENT.ITEMS') |
	 'INTEGRATED_CNC_SCHEMA.DOCUMENT'
	  IN TYPEOF (aduc\
	  document_usage_constraint_assignment.
	  assigned_document_usage.source) )) |
	 'INTEGRATED_CNC_SCHEMA.DOCUMENT_FILE' IN TYPEOF(doc) ))
	  >=1));
    WR7: ((NOT (SELF\characterized_object.description = 'marking')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN
	 (pd,'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND (it.name = 'marking text')) )) = 1)) )) 
	 = 0)) )) = 0));
    WR8: ((NOT (SELF\characterized_object.description = 'thread')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN
	 (pd,'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND (it.name = 'removal direction') AND 
	 ((it.description = 'internal') OR 
	 (it.description = 'external'))) )) = 1)) )) = 0)) )) = 0));
    WR9: ((NOT (SELF\characterized_object.description = 'thread')) OR 
	  (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	  'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	  (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN
	  (pd,'INTEGRATED_CNC_SCHEMA.' + 
	  'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	  (('INTEGRATED_CNC_SCHEMA.' + 
	  'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	  IN TYPEOF(pdr.used_representation)) ) | 
	  (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	  (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
	  IN TYPEOF(it)) AND (it.name = 'qualifier')) ))<= 1)) ))= 0)) )) 
	  = 0));
    WR10: ((NOT (SELF\characterized_object.description = 'thread')) OR 
	  (SIZEOF(QUERY ( pd <*	 USEDIN(SELF,
	  'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	  (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN
	  (pd,'INTEGRATED_CNC_SCHEMA.' + 
	  'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	  (('INTEGRATED_CNC_SCHEMA.' + 
	  'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	  IN TYPEOF(pdr.used_representation)) ) | 
	  (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	  (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
	  IN TYPEOF(it)) AND (it.name = 'hand')) )) = 1)) )) = 0)) )) 
	  = 0));
    WR11: ((NOT (SELF\characterized_object.description = 'thread')) OR 
	  (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	  'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	  (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN
	  (pd,'INTEGRATED_CNC_SCHEMA.' + 
	  'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	  (('INTEGRATED_CNC_SCHEMA.' + 
	  'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	  IN TYPEOF(pdr.used_representation)) ) | 
	  (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	  (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
	  IN TYPEOF(it)) AND (it.name = 'fit class')) )) = 1)) )) = 
	  0)) )) = 0));
    WR12: ((NOT (SELF\characterized_object.description = 'thread')) OR 
	  (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	  'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	  (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN
	  (pd,'INTEGRATED_CNC_SCHEMA.' + 
	  'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	  (('INTEGRATED_CNC_SCHEMA.' + 
	  'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	  IN TYPEOF(pdr.used_representation)) ) | 
	  (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	  (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
	  IN TYPEOF(it)) AND (it.name = 'form')) )) = 1)) )) = 0)) )) 
	  = 0));
    WR13: ((NOT (SELF\characterized_object.description = 'thread')) OR 
	  (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	  'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	  (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN
	  (pd,'INTEGRATED_CNC_SCHEMA.' + 
	  'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	  (('INTEGRATED_CNC_SCHEMA.' + 
	  'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	  IN TYPEOF(pdr.used_representation)) ) | 
	  (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	  ((SIZEOF([
	  'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	  'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	  TYPEOF(it)) = 2) AND (it.name = 'major diameter')) )) = 1)) )) 
	  = 0)) )) = 0));
    WR14: ((NOT (SELF\characterized_object.description = 'thread')) OR 
	  (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	  'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	  (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN
	  (pd,'INTEGRATED_CNC_SCHEMA.' + 
	  'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	  (('INTEGRATED_CNC_SCHEMA.' + 
	  'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	  IN TYPEOF(pdr.used_representation)) ) | 
	  (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	  ((SIZEOF([
	  'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	  'INTEGRATED_CNC_SCHEMA.RATIO_MEASURE_WITH_UNIT'] *
	  TYPEOF(it)) = 2) AND (it.name = 'number of threads')) )) = 1)) )) 
	  = 0)) )) = 0));
    WR15: (NOT (SELF\characterized_object.description IN [ 'knurl',
	  'thread'])) OR
	  (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	  'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	  ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	  IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN
	  (pds,'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	  ((SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	  'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' 
	  + 'RELATED_SHAPE_ASPECT') | 
	  ((sar.description = 'applied shape') AND 
	  (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	  IN TYPEOF(sar))) ) | 
	  ('INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT' 
	  IN TYPEOF(sdr.relating_shape_aspect)) )) = 1)) )) <= 1)) )) = 0);  
END_ENTITY; -- externally_defined_feature_definition


ENTITY face_shape_representation
  SUBTYPE OF (shape_representation);
  WHERE
    WR1: (SIZEOF(SELF.items) >= 1);
    WR2: (SIZEOF(QUERY ( it <* SELF.items | (NOT (
	 ('INTEGRATED_CNC_SCHEMA.FACE_SURFACE' IN TYPEOF(it)) OR
	 ('INTEGRATED_CNC_SCHEMA.ORIENTED_FACE' IN TYPEOF(it)) ))
	  )) = 0);
END_ENTITY; -- face_shape_representation 


ENTITY feature_component_definition
  SUBTYPE OF (characterized_object);
  WHERE
    WR1: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE')) = 1)) )) 
	 = 0);
END_ENTITY; -- feature_component_definition


ENTITY feature_component_relationship
  SUPERTYPE OF (ONEOF (pattern_omit_membership,pattern_offset_membership))
  SUBTYPE OF (shape_aspect_relationship);
  WHERE
    WR1: ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.COMPOSITE_SHAPE_ASPECT',
	 'INTEGRATED_CNC_SCHEMA.REPLICATE_FEATURE',
	 'INTEGRATED_CNC_SCHEMA.TRANSITION_FEATURE',
	 'INTEGRATED_CNC_SCHEMA.MODIFIED_PATTERN'] * TYPEOF
	 (SELF.relating_shape_aspect)) = 1) OR 
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_DEFINITION' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition)) OR 
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition)));
END_ENTITY; -- feature_component_relationship


ENTITY feature_definition
  SUBTYPE OF (characterized_object);
  WHERE
    WR1: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0);
    WR2: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 ('INTEGRATED_CNC_SCHEMA.PLACEMENT' 
	 IN TYPEOF (it)) AND (it.name = 'orientation'))) = 1))) = 0))) = 0;
    WR3: SIZEOF (['INTEGRATED_CNC_SCHEMA.BOSS', 
	 'INTEGRATED_CNC_SCHEMA.TURNED_KNURL', 
	 'INTEGRATED_CNC_SCHEMA.THREAD', 
	 'INTEGRATED_CNC_SCHEMA.MARKING',	     
	 'INTEGRATED_CNC_SCHEMA.RIB_TOP',	   
	 'INTEGRATED_CNC_SCHEMA.ROUND_HOLE',
	 'INTEGRATED_CNC_SCHEMA.OUTSIDE_PROFILE', 
	 'INTEGRATED_CNC_SCHEMA.POCKET', 
	 'INTEGRATED_CNC_SCHEMA.REMOVAL_VOLUME', 
	 'INTEGRATED_CNC_SCHEMA.REVOLVED_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.OUTER_ROUND', 
	 'INTEGRATED_CNC_SCHEMA.FLAT_FACE', 
	 'INTEGRATED_CNC_SCHEMA.PROTRUSION', 
	 'INTEGRATED_CNC_SCHEMA.ROUNDED_END', 
	 'INTEGRATED_CNC_SCHEMA.SLOT', 
	 'INTEGRATED_CNC_SCHEMA.SPHERICAL_CAP',
	 'INTEGRATED_CNC_SCHEMA.STEP', 
	 'INTEGRATED_CNC_SCHEMA.COMPOUND_FEATURE',
	 'INTEGRATED_CNC_SCHEMA.REPLICATE_FEATURE',
	 'INTEGRATED_CNC_SCHEMA.EXTERNALLY_DEFINED_FEATURE_DEFINITION']
	 * TYPEOF (SELF)) = 1;

    WR4: (NOT (SIZEOF (['INTEGRATED_CNC_SCHEMA.ROUND_HOLE', 
	 'INTEGRATED_CNC_SCHEMA.BOSS', 
	 'INTEGRATED_CNC_SCHEMA.OUTSIDE_PROFILE',	    
	 'INTEGRATED_CNC_SCHEMA.REMOVAL_VOLUME',
	 'INTEGRATED_CNC_SCHEMA.FLAT_FACE',
	 'INTEGRATED_CNC_SCHEMA.POCKET',
	 'INTEGRATED_CNC_SCHEMA.PROTRUSION',
	 'INTEGRATED_CNC_SCHEMA.RIB_TOP',
	 'INTEGRATED_CNC_SCHEMA.ROUNDED_END',
	 'INTEGRATED_CNC_SCHEMA.SLOT',
	 'INTEGRATED_CNC_SCHEMA.STEP']
	 * TYPEOF (SELF)) = 1)) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.' +
	 'DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.PLANAR_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation))AND
	 (pdr.used_representation.name = 'maximum feature limit'))) = 1))) 
	 <= 1);
END_ENTITY; -- feature_definition


ENTITY feature_pattern
  SUBTYPE OF (replicate_feature);
  WHERE
    WR1: SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd, 
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) AND
	 (SIZEOF( QUERY( srwp_i <* pdr.used_representation.items |
	 NOT ('INTEGRATED_CNC_SCHEMA.PLACEMENT' 
	 IN TYPEOF(srwp_i)) )) > 0 ) ))	  > 0  )) = 0;
    WR2: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 ('INTEGRATED_CNC_SCHEMA.PLACEMENT' 
	 IN TYPEOF (it)) AND (it.name = 'base feature placement'))) > 1))) 
	 = 0))) = 0;
END_ENTITY; -- feature_pattern

(* NOT USED BY STEP-NC, for compatibility with AP-224 *)
ENTITY fillet
  SUBTYPE OF (transition_feature);
  WHERE
    WR1: (NOT (SELF\shape_aspect.description = 'constant radius')) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <*  USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF (pdr.used_representation))) = 1))) = 0);
    WR2: (NOT (SELF\shape_aspect.description = 'constant radius')) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 (NOT (SIZEOF (impl_rep.used_representation.items) >= 1)
	 AND(SIZEOF (impl_rep.used_representation.items) <= 3)))) 
	 = 0))) = 0); 
    WR3: (NOT (SELF.description = 'constant radius')) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] * 
	 TYPEOF (it)) = 2) AND (it.name = 'radius'))) = 1))) = 0))) = 0);
    WR4: (NOT (SELF.description = 'constant radius')) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] * 
	 TYPEOF (it)) = 2) AND (it.name = 'first offset'))) <= 1))) 
	 = 0))) = 0);
    WR5: (NOT (SELF.description = 'constant radius')) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] * 
	 TYPEOF (it)) = 2) AND (it.name = 'second offset'))) <= 1))) 
	 = 0))) = 0);

    WR6: SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.' +
	 'DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.FACE_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'fillet face'))) = 1))) = 0; 
    WR7: SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.' +
	 'DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.FACE_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'first face shape'))) = 1))) = 0; 
    WR8: SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.' +
	 'DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.FACE_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'second face shape'))) = 1))) = 0;  
END_ENTITY; -- fillet


ENTITY flat_face
  SUBTYPE OF (feature_definition);
  WHERE
    WR1: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 (('INTEGRATED_CNC_SCHEMA.DIRECTION_SHAPE_REPRESENTATION' 
	 IN TYPEOF(pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'removal direction')) )) = 1)) )) 
	 = 0);
    WR2: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'course of travel occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'path feature component usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.PATH_FEATURE_COMPONENT' 
	 IN TYPEOF(sdr.relating_shape_aspect)) AND 
	 (sdr.relating_shape_aspect.description = 'linear') AND 
	 (sdr.name = 'course of travel')) )) = 1)) )) = 1)) )) = 0);
    WR3: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'removal boundary occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'profile usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.LINEAR_PROFILE' 
	 IN TYPEOF(sdr.relating_shape_aspect)) AND 
	 (sdr.name = 'removal boundary')) )) = 1)) )) = 1)) )) = 0);
    WR4: SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'enclosed boundary occurrence') AND
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'profile usage') AND
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.CIRCULAR_CLOSED_PROFILE', 
	 'INTEGRATED_CNC_SCHEMA.NGON_CLOSED_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.RECTANGULAR_CLOSED_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.CLOSED_PATH_PROFILE'] *
	 TYPEOF (sdr.relating_shape_aspect)) = 1) AND
	 (sdr.relating_shape_aspect.description = 'boundary'))) 
	 = 1))) <= 1))) = 0;
END_ENTITY; -- flat_face


ENTITY hole_bottom
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF(SELF.of_shape.definition));
    WR2: (SELF.description IN ['through', 'flat', 'flat with radius',
	 'flat with taper','spherical', 'conical']);
    WR3: ((NOT (SELF.description = 'through')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION')) = 0)) )) 
	  = 0));
    WR4: ((NOT (SELF.description IN ['flat with radius', 
	 'flat with taper', 'spherical','conical'])) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0));
    WR5: ((NOT (SELF.description = 'flat')) OR 
	 (SIZEOF(QUERY ( pd <*	USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 0)) )) 
	  = 0)) )) = 0));
    WR6: ((NOT (SELF.description IN ['flat with radius','spherical'])) 
	 OR (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 1)) )) 
	 = 0)) )) = 0));
    WR7: ((NOT (SELF.description = 'flat with taper')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 2)) )) 
	 = 0)) )) = 0));
    WR8: ((NOT (SELF.description = 'conical')) OR (SIZEOF(
	 QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF (impl_rep.used_representation.items) >= 1)
	 AND  (SIZEOF (impl_rep.used_representation.items) <= 2)) )) 
	 = 0)) )) = 0));
    WR9: ((SELF.description = 'through') OR 
	 (SIZEOF(QUERY ( fcr <* QUERY ( sar <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATING_SHAPE_ASPECT') | 
	 ((sar.description = 'hole bottom usage') AND
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(sar))) ) | 
	 ((fcr.name IN ['hole depth start','hole depth end'])) )) >= 1));
    WR10: ((NOT (SELF.description = 'flat with radius')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] * 
	 TYPEOF(it)) = 2) AND (it.name = 'corner radius')))) = 1)) )) 
	 = 0)) )) = 0));
    WR11: ((NOT (SELF.description = 'spherical')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'radius')) )) = 1)) )) = 
	 0)) )) = 0));
    WR12: ((NOT (SELF.description = 'conical')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'tip radius')) )) <= 1)) )) 
	 = 0)) )) = 0));
    WR13: ((NOT (SELF.description = 'conical')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'tip angle')) )) = 1)) )) 
	 = 0)) )) = 0));
    WR14: (SIZEOF(QUERY ( fcr <* QUERY ( sar <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATING_SHAPE_ASPECT') | 
	 ((sar.description = 'hole bottom usage') AND
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(sar))) ) | 
       ((fcr.related_shape_aspect.description ='bottom condition occurrence') 
	 AND ('INTEGRATED_CNC_SCHEMA.ROUND_HOLE' 
	 IN TYPEOF(fcr.related_shape_aspect.of_shape.definition))) )) >= 1);
    WR15: ((NOT (SELF.description = 'flat with taper')) OR (SIZEOF(
	 QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |  
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'final diameter')))) = 1)) )) 
	 = 0)) )) = 0));
    WR16: ((NOT (SELF.description = 'flat with taper')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name =  'taper diameter')) )) = 1)) )) 
	 = 0)) )) = 0));
END_ENTITY; -- hole_bottom


ENTITY instanced_feature
  SUBTYPE OF (feature_definition, shape_aspect);
  WHERE
    WR1: 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION' IN 
	 TYPEOF (SELF.of_shape.definition);
    WR2: SELF.product_definitional;
END_ENTITY;  -- instanced_feature


ENTITY linear_profile
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF(SELF.of_shape.definition));
    WR2: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0);
    WR3: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 2)) )) 
	 = 0)) )) = 0);
    WR4: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 (('INTEGRATED_CNC_SCHEMA.PLACEMENT' IN TYPEOF(it)) AND 
	 (it.name = 'orientation')) )) = 1)) )) = 0)) )) = 0);
    WR5: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'profile length')) )) = 1)) )) 
	 = 0)) )) = 0);
END_ENTITY; -- linear_profile


ENTITY location_shape_representation
  SUBTYPE OF (shape_representation);
  WHERE
    WR1: (SIZEOF(SELF.items) = 1);
    WR2: (SIZEOF(QUERY ( it <* SELF.items | 
	(NOT ('INTEGRATED_CNC_SCHEMA.POINT' 
	IN TYPEOF(it))) )) = 0);
END_ENTITY; -- location_shape_representation


(* NOT USED BY STEP-NC but included for compatibility with AP-224 *)
ENTITY marking
  SUBTYPE OF (feature_definition);
  WHERE
    WR1: SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd, 
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' IN
	 TYPEOF(pdr.used_representation)) AND
	 ({2 <= SIZEOF(pdr.used_representation.items) <=6} ) )) 
	 = 1 )) = 1;
    WR2: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* 
	 QUERY ( pdr <* USEDIN(pd,'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND (it.name = 'marking text')) )) = 1)) )) 
	 = 0)) )) = 0);
    WR3: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND (it.name = 'special instructions')) )) <= 1)) )) 
	 = 0)) )) = 0);
    WR4: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd, 
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND (it.name = 'font name')))) <= 1)))) 
	 = 0)) )) = 0);
    WR5: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'character height')) )) <= 1)) )) 
	 = 0)) )) = 0);
    WR6: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'character spacing')) )) <= 1)) )) 
	 = 0)) )) = 0);
    WR7: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | 
	 (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' 
	 + 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'applied shape') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT' 
	 IN TYPEOF(sdr.relating_shape_aspect)) )) = 1)) )) = 1)) )) = 0);
END_ENTITY; -- marking



ENTITY modified_pattern
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: SIZEOF( QUERY (fcr <* QUERY(sar <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATING_SHAPE_ASPECT') |
	 'INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF (sar)) |
	 (SIZEOF( 
	 ['INTEGRATED_CNC_SCHEMA.REPLICATE_FEATURE',
	 'INTEGRATED_CNC_SCHEMA.INSTANCED_FEATURE'] * 
	 TYPEOF (fcr.related_shape_aspect.of_shape.definition)) >= 1)  AND
	 (fcr.description = 'base shape')) ) = 1;
    WR2: SIZEOF( QUERY (fcr <* QUERY(sar <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATING_SHAPE_ASPECT') |
	 'INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF (sar)) |
	 (SIZEOF( 
	 ['INTEGRATED_CNC_SCHEMA.CIRCULAR_PATTERN', 
	 'INTEGRATED_CNC_SCHEMA.RECTANGULAR_PATTERN'] * 
	 TYPEOF(fcr.related_shape_aspect.of_shape.definition)) = 1) AND 
	 (fcr.description = 'base pattern')) ) = 1;
    WR3: SIZEOF(QUERY ( sar <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATING_SHAPE_ASPECT') | 
	 (SIZEOF(QUERY ( msar <* USEDIN(sar.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 (SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.PATTERN_OFFSET_MEMBERSHIP',
	 'INTEGRATED_CNC_SCHEMA.PATTERN_OMIT_MEMBERSHIP'] * 
	 TYPEOF(sar)) = 1) AND (sar.description='modified pattern') 
	 AND (sar :<>: msar) )) >= 1) )) = 0;
END_ENTITY; -- modified_pattern


ENTITY ngon_closed_profile
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: 'INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF (SELF.of_shape.definition);
    WR2: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation))) = 1))) = 0;
    WR3: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT ((SIZEOF (impl_rep.used_representation.items) >= 3)  
	 AND (SIZEOF(impl_rep.used_representation.items) <= 4)))) = 0))) = 0;
    WR4:  SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd, 
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) AND
	 (SIZEOF( QUERY( srwp_i <* pdr.used_representation.items |
	 (srwp_i.name = 'orientation') OR
	 (srwp_i.name = 'number of sides') OR
	 (srwp_i.name = 'circumscribed diameter') OR
	 (srwp_i.name = 'corner radius') OR
	 (srwp_i.name = 'diameter across flats'))) 
	 = SIZEOF(pdr.used_representation.items))  )) = 1 )) = 1;

    WR5: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 ('INTEGRATED_CNC_SCHEMA.PLACEMENT' IN TYPEOF (it)) AND 
	 (it.name = 'orientation'))) = 1))) = 0))) = 0;
    WR6: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 ('INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM' 
	 IN TYPEOF (it)) AND 
	 ('INTEGRATED_CNC_SCHEMA.COUNT_MEASURE' 
	 IN TYPEOF (it\measure_with_unit.value_component)) AND 
	 (it.name = 'number of sides'))) = 1))) = 0))) = 0;
    WR7: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	  NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *	
	 TYPEOF (it)) = 2) AND 
	 (it.name IN ['circumscribed diameter','diameter across flats']) )) 
	 = 1) )) = 0))) = 0;
    WR8: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *	
	 TYPEOF (it)) = 2) AND 
	 (it.name = 'corner radius'))) <= 1))) = 0))) = 0;
END_ENTITY; -- ngon_closed_profile



ENTITY ngon_shape_representation
  SUBTYPE OF (shape_representation_with_parameters);
  WHERE
    WR1: (SIZEOF(SELF.items) = 5);
    WR2: (SIZEOF(QUERY ( it <* SELF.items | 
	 (('INTEGRATED_CNC_SCHEMA.PLACEMENT' 
	 IN TYPEOF(it)) AND (it.name = 'orientation')) )) = 1);
    WR3: (SIZEOF(QUERY ( it <* SELF.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'length')) )) = 1);
    WR4: (SIZEOF(QUERY ( it <* SELF.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'corner radius')) )) = 1);
    WR5: SIZEOF (QUERY (it <* SELF.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *	
	 TYPEOF (it)) = 2) AND
       (it.name IN ['circumscribed diameter','diameter across flats']) ))= 1;

    WR6: (SIZEOF(QUERY ( it <* SELF.items |
	 (('INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND 
	 ('INTEGRATED_CNC_SCHEMA.COUNT_MEASURE' 
	 IN TYPEOF(it\measure_with_unit.value_component)) AND 
	 (it.name = 'number of sides')) )) = 1);
END_ENTITY; -- ngon_shape_representation


ENTITY open_path_profile
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF(SELF.of_shape.definition));
    WR2: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0);
    WR3: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF (impl_rep.used_representation.items) = 1)) )) 
	 = 0)) )) = 0);
    WR4: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 (('INTEGRATED_CNC_SCHEMA.PLACEMENT' 
	 IN TYPEOF(it)) AND 
	 (it.name = 'orientation')) )) = 1)) )) = 0)) )) = 0);
    WR5: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PATH_SHAPE_REPRESENTATION' 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0);
    WR6: SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.PLANAR_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation))AND
	 (pdr.used_representation.name = 'profile limit') )) <= 1))) = 0;
END_ENTITY;  -- open_path_profile


(* NOT USED BY STEP-NC but included for compatibility with AP-224 *)
ENTITY outer_round
  SUBTYPE OF (feature_definition);
  WHERE
    WR1: ((NOT (SELF\characterized_object.description = 'outer diameter')) OR 
	 (SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd, 
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) AND
	 (SIZEOF (pdr.used_representation.items) = 3) )) = 1 )) = 1));
    WR2: ((NOT (SELF\characterized_object.description 
	 = 'outer diameter to shoulder')) OR 
	 (SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd, 
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) AND
	 (SIZEOF (pdr.used_representation.items) = 2) )) = 1 )) = 1));
    WR3: (SELF\characterized_object.description IN 
	 ['outer diameter', 'outer diameter to shoulder']);
    WR4: ((NOT (SELF\characterized_object.description = 'outer diameter')) OR 
	 (SIZEOF( QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'length')) )) = 1)) ))
	 = 0)) )) = 0));
    WR5: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'diameter')) )) = 1)) )) 
	 = 0)) )) = 0);
    WR6: ((NOT (SELF\characterized_object.description 
	 = 'outer diameter to shoulder')) OR (
	 SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' IN
	 TYPEOF(pd)) ) | 
	 (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'v-shape boundary occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'profile usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.VEE_PROFILE' 
	 IN TYPEOF(sdr.relating_shape_aspect)) AND 
	 (sdr.relating_shape_aspect.description = 'v-shape')) )) = 1)) )) 
	 = 1)) )) = 0));
    WR7: ((NOT (SELF\characterized_object.description = 'outer diameter')) OR 
	 (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'reduced size occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'taper usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.TAPER' 
	 IN TYPEOF(sdr.relating_shape_aspect)) AND 
	 (sdr.name = 'reduced size')) ))  = 1)) ))
	 <= 1)) )) = 0));
END_ENTITY; -- outer_round


ENTITY outside_profile
  SUBTYPE OF (feature_definition);
  WHERE
    WR1: SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd, 
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) AND
	 (SIZEOF (pdr.used_representation.items) = 1) )) = 1 )) = 1;
    WR2: SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description IN ['boundary occurrence',
	 'non-planar boundary occurrence',
	 'partial circular boundary occurrence',
	 'closed circular boundary occurrence',
	 'open rectangular boundary occurrence',
	 'closed rectangular boundary occurrence']) )) =1)  ))=0;
    WR3: (NOT(SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'boundary occurrence') )) =1)  ))=0))  OR
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'profile usage') AND
	 ('INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_DEFINING_RELATIONSHIP' IN TYPEOF (sar))) |
	 (SIZEOF (['INTEGRATED_CNC_SCHEMA.CIRCULAR_CLOSED_PROFILE', 
	 'INTEGRATED_CNC_SCHEMA.NGON_CLOSED_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.RECTANGULAR_CLOSED_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.CLOSED_PATH_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.SQUARE_U_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.PARTIAL_CIRCULAR_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.ROUNDED_U_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.LINEAR_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.VEE_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.TEE_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.OPEN_PATH_PROFILE'] *
	 TYPEOF (sdr.relating_shape_aspect)) = 1) AND
	 (sdr.relating_shape_aspect.description = 'outside boundary'))) 
	 = 1))) = 1))) = 0);
    WR4: (NOT(SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description IN ['complex boundary occurrence',
	 'partial circular boundary occurrence',
	 'closed circular boundary occurrence',
	 'open rectangular boundary occurrence',
	 'closed rectangular boundary occurrence']) ))=1)   ))=0)) OR
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 NOT(SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'profile floor usage') AND
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 'INTEGRATED_CNC_SCHEMA.PROFILE_FLOOR' 
	 IN TYPEOF (sdr.relating_shape_aspect))) = 1))) = 0))) = 0);
    WR5: (NOT(SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description IN ['outside boundary',
	 'complex boundary occurrence',
	 'partial circular boundary occurrence',
	 'closed circular boundary occurrence',
	 'open rectangular boundary occurrence',
	 'closed rectangular boundary occurrence']) ))=1)   ))=0)) OR
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'path feature component usage') AND
	 ('INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_DEFINING_RELATIONSHIP' IN TYPEOF (sar))) |
	 (SIZEOF (['INTEGRATED_CNC_SCHEMA.PATH_FEATURE_COMPONENT'] *
	 TYPEOF (sdr.relating_shape_aspect)) = 1) AND
	 (sdr.name = 'profile swept shape') AND
	 (sdr.relating_shape_aspect.description='linear') ))  = 1))) 
	 = 1))) = 0);
    WR6: (NOT(SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'complex boundary occurrence') )) 
	 =1)  ))=0))  OR
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'profile usage') AND
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 (SIZEOF (['INTEGRATED_CNC_SCHEMA.CIRCULAR_CLOSED_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.NGON_CLOSED_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.RECTANGULAR_CLOSED_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.CLOSED_PATH_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.SQUARE_U_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.PARTIAL_CIRCULAR_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.ROUNDED_U_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.VEE_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.TEE_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.LINEAR_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.OPEN_PATH_PROFILE'] *  
	 TYPEOF (sdr.relating_shape_aspect)) =1))  ) 
	 = 1)))= 1))) = 0);
    WR7: (NOT(SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'partial circular boundary occurrence') )) 
	 =1)  ))=0))  OR
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'profile usage') AND
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 ('INTEGRATED_CNC_SCHEMA.PARTIAL_CIRCULAR_PROFILE' IN  
	 TYPEOF (sdr.relating_shape_aspect)))) 
	 = 1)))= 1))) = 0);
    WR8: (NOT(SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'closed circular boundary occurrence') )) 
	 =1)  ))=0))  OR
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'profile usage') AND
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 ('INTEGRATED_CNC_SCHEMA.CIRCULAR_CLOSED_PROFILE' IN  
	 TYPEOF (sdr.relating_shape_aspect)))) 
	 = 1)))= 1))) = 0);
    WR9: (NOT(SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'open rectangular boundary occurrence') )) 
	 =1)  ))=0))  OR
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'profile usage') AND
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 ('INTEGRATED_CNC_SCHEMA.SQUARE_U_PROFILE' IN  
	 TYPEOF (sdr.relating_shape_aspect)))) 
	 = 1)))= 1))) = 0);
   WR10: (NOT(SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'closed rectangular boundary occurrence') )) 
	 =1)  ))=0))  OR
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'profile usage') AND
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 ('INTEGRATED_CNC_SCHEMA.RECTANGULAR_CLOSED_PROFILE' IN	 
	 TYPEOF (sdr.relating_shape_aspect)) )) = 1)))
	 = 1))) = 0);
   WR11: (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description IN ['boundary occurrence',
	 'complex boundary occurrence',
	 'partial circular boundary occurrence',
	 'closed circular boundary occurrence',
	 'open rectangular boundary occurrence',
	 'closed rectangular boundary occurrence']) )) =1)  ))=0) OR
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 (('INTEGRATED_CNC_SCHEMA.DIRECTION_SHAPE_REPRESENTATION' 
	 IN TYPEOF(pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'removal direction')) )) = 1)) )) 
	 = 0);
END_ENTITY; -- outside_profile


ENTITY partial_circular_profile
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF(SELF.of_shape.definition));
    WR2: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0);
    WR3: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF (impl_rep.used_representation.items) >= 3)) )) 
	 = 0)) )) = 0);
    WR4: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 (('INTEGRATED_CNC_SCHEMA.PLACEMENT' 
	 IN TYPEOF(it)) AND (it.name = 'orientation')) )) = 1)) )) 
	 = 0)) )) = 0);
    WR5: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'radius')))) = 1)) )) 
	 = 0)) )) = 0);
    WR6: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'sweep angle')) )) = 1)) )) 
	 = 0)) )) = 0);
    WR7: SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.PLANAR_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation))AND
	 (pdr.used_representation.name = 'profile limit'))) <= 1))) = 0;
END_ENTITY; -- partial_circular_profile


ENTITY path_feature_component
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF(SELF.of_shape.definition));
    WR2: (SELF.description IN ['partial circular','complete circular',
	 'linear','complex']);
    WR3: ((NOT (SELF.description = 'complex')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0));
    WR4: ((SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 (('INTEGRATED_CNC_SCHEMA.PLACEMENT' 
	 IN TYPEOF(it)) AND (it.name = 'orientation')) )) = 1)) )) 
	 = 0)) )) = 0));
    WR5: ((NOT (SELF.description = 'partial circular')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 3)) )) 
	 = 0)) )) = 0));
    WR6: ((NOT (SELF.description = 'partial circular')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'radius')) )) = 1)) )) 
	 = 0)) )) = 0));
    WR7: ((NOT (SELF.description = 'partial circular')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'sweep angle')) )) = 1)) )) 
	 = 0)) )) = 0));
    WR8: ((NOT (SELF.description = 'complete circular')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 2)) )) 
	 = 0)) )) = 0));
    WR9: ((NOT (SELF.description = 'complete circular')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'radius')) )) = 1)) )) 
	 = 0)) )) = 0));
   WR10: ((NOT (SELF.description = 'linear')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN( pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 2)) )) 
	  = 0)) )) = 0));
   WR11: ((NOT (SELF.description = 'linear')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'distance')) )) = 1)) )) 
	 = 0)) )) = 0));
   WR12: ((NOT (SELF.description = 'linear')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.DIRECTION_SHAPE_REPRESENTATION' 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0));
   WR13: ((NOT (SELF.description = 'complex')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.PATH_SHAPE_REPRESENTATION' 
	 IN TYPEOF(pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'sweep path')AND		  
	 (SIZEOF( QUERY( srwp_i <* pdr.used_representation.items |
	 (srwp_i.name = 'profile shape') )) = 1)
	 ) )) = 1)) )) = 0));
END_ENTITY; -- path_feature_component



ENTITY path_shape_representation
  SUBTYPE OF (shape_representation);
  WHERE
    WR1: (SIZEOF(SELF.items) >= 1);
    WR2: (SIZEOF(QUERY ( i <* SELF.items | (SIZEOF([
	     'INTEGRATED_CNC_SCHEMA.BOUNDED_CURVE',
	     'INTEGRATED_CNC_SCHEMA.EDGE_CURVE',
	     'INTEGRATED_CNC_SCHEMA.PATH'] * TYPEOF(i)) = 
	     1) )) >= 1);
END_ENTITY; -- path_shape_representation


ENTITY pattern_offset_membership
  SUBTYPE OF (feature_component_relationship);
  WHERE
    WR1: (SIZEOF(QUERY ( fcr <* QUERY ( sar <* USEDIN(
	 SELF.relating_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' 
	 + 'RELATING_SHAPE_ASPECT') | 
	 (('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(sar)) AND (sar :<>: SELF)) ) | 
	 ((SIZEOF (QUERY( pdr <*(QUERY(pd <* USEDIN
	 (fcr.related_shape_aspect.of_shape,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd))) |
	 SIZEOF (['INTEGRATED_CNC_SCHEMA.CIRCULAR_PATTERN',
	 'INTEGRATED_CNC_SCHEMA.RECTANGULAR_PATTERN']
	 * TYPEOF(pdr.definition))  =1 )) = 0 )) )) = 0);   

    WR2: (SIZEOF(QUERY ( fcr <* QUERY ( sar <* USEDIN(
	 SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' + 
	 'RELATED_SHAPE_ASPECT') |
	 (('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(sar)) AND (sar :<>: SELF)) ) | 
	 (fcr.description='modified pattern') AND
	 ('INTEGRATED_CNC_SCHEMA.MODIFIED_PATTERN' 
	 IN TYPEOF(fcr.relating_shape_aspect)) )) >= 1);
    WR3: (SIZEOF(QUERY ( fcr <* QUERY ( sar <* USEDIN(
	 SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' + 
	 'RELATED_SHAPE_ASPECT') |
	 (('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(sar)) AND (sar :<>: SELF)) ) | 
	 (('INTEGRATED_CNC_SCHEMA.MODIFIED_PATTERN' 
	 IN TYPEOF(fcr.relating_shape_aspect)) AND 
	 (NOT (SIZEOF(QUERY ( modfcr <* QUERY ( modsar <* USEDIN(
	 fcr.relating_shape_aspect,'INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_ASPECT_RELATIONSHIP.RELATING_SHAPE_ASPECT') | 
	 ((SIZEOF(['INTEGRATED_CNC_SCHEMA.CIRCULAR_PATTERN',
	 'INTEGRATED_CNC_SCHEMA.RECTANGULAR_PATTERN'] * 
	 TYPEOF(modsar.related_shape_aspect.of_shape.definition)) = 1) AND 
	 (modsar :<>: fcr)) ) | 
	 (NOT (modfcr.related_shape_aspect.of_shape.definition :=: 
	 SELF.relating_shape_aspect.of_shape.definition)) )) 
	  = 0))) )) = 0);
    WR4: ((NOT ('INTEGRATED_CNC_SCHEMA.RECTANGULAR_PATTERN' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition))) OR
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(USEDIN(pd,'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION')) = 2)) )) = 0));
    WR5n: ((NOT ('INTEGRATED_CNC_SCHEMA.CIRCULAR_PATTERN' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition))) OR
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(USEDIN(pd,'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION')) = 1)) )) = 0));
    WR6: ((NOT ('INTEGRATED_CNC_SCHEMA.CIRCULAR_PATTERN' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition))) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (NOT (SIZEOF(pdr.used_representation.items) = 2)) )) = 0)) )) 
	 = 0));
    WR7: ((NOT ('INTEGRATED_CNC_SCHEMA.CIRCULAR_PATTERN' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition))) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND 
	 ('INTEGRATED_CNC_SCHEMA.COUNT_MEASURE' 
	 IN TYPEOF(it\measure_with_unit.value_component)) AND 
	 (it.name = 'index number')) )) = 1)) )) = 0)) )) = 0));
    WR8: ((NOT ('INTEGRATED_CNC_SCHEMA.CIRCULAR_PATTERN' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition))) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT' 
	 IN TYPEOF(it)) AND (it.name = 'offset')) )) = 1)) )) = 0)) )) 
	 = 0));
    WR9: ((NOT ('INTEGRATED_CNC_SCHEMA.RECTANGULAR_PATTERN' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition))) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION')|
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items ) = 3)) )) 
	 = 0)) )) = 0));
   WR10: ((NOT ('INTEGRATED_CNC_SCHEMA.RECTANGULAR_PATTERN' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition))) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION')|
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND 
	 ('INTEGRATED_CNC_SCHEMA.COUNT_MEASURE' 
	 IN TYPEOF(it\measure_with_unit.value_component)) AND 
	 (it.name = 'row index')) )) = 1)) )) = 0)) )) = 0));
   WR11: ((NOT ('INTEGRATED_CNC_SCHEMA.RECTANGULAR_PATTERN' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition))) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND 
	 ('INTEGRATED_CNC_SCHEMA.COUNT_MEASURE' 
	 IN TYPEOF(it\measure_with_unit.value_component)) AND 
	 (it.name = 'column index')) )) = 1)) )) = 0)) )) = 0));
   WR12: ((NOT ('INTEGRATED_CNC_SCHEMA.RECTANGULAR_PATTERN' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition))) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 (('INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT' 
	 IN TYPEOF(it)) AND (it.name = 'offset distance')) )) = 1)) )) 
	 = 0)) )) = 0));
   WR13: ((NOT ('INTEGRATED_CNC_SCHEMA.RECTANGULAR_PATTERN' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition))) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 (('INTEGRATED_CNC_SCHEMA.DIRECTION_SHAPE_REPRESENTATION' 
	 IN TYPEOF(pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'offset direction')) )) = 1)) )) 
	 = 0));
END_ENTITY; -- pattern_offset_membership 


ENTITY pattern_omit_membership
  SUBTYPE OF (feature_component_relationship);
  WHERE
    WR1: (SIZEOF(QUERY ( fcr <* QUERY ( sar <* USEDIN(
	 SELF.relating_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' 
	 + 'RELATING_SHAPE_ASPECT') | 
	 (('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(sar)) AND (sar :<>: SELF)) ) | 
	 ((SIZEOF (QUERY( pdr <*(QUERY(pd <* USEDIN
	 (fcr.related_shape_aspect.of_shape,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd))) |
	 SIZEOF (['INTEGRATED_CNC_SCHEMA.CIRCULAR_PATTERN',
	 'INTEGRATED_CNC_SCHEMA.RECTANGULAR_PATTERN']
	 * TYPEOF(pdr.definition))  =1 )) = 0 )) )) = 0);   
    WR2: (SIZEOF(QUERY ( fcr <* QUERY ( sar <* USEDIN(
	 SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(sar)) AND (sar :<>: SELF)) ) | 
	 (fcr.description='modified pattern') AND
	 ('INTEGRATED_CNC_SCHEMA.MODIFIED_PATTERN' 
	 IN TYPEOF(fcr.relating_shape_aspect)) )) >= 1);
    WR3: (SIZEOF(QUERY ( fcr <* QUERY ( sar <* USEDIN(
	 SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(sar)) AND (sar :<>: SELF)) ) | 
	 (('INTEGRATED_CNC_SCHEMA.MODIFIED_PATTERN' 
	 IN TYPEOF(fcr.relating_shape_aspect)) AND 
	 (NOT (SIZEOF(QUERY ( modfcr <* QUERY ( modsar <* USEDIN(
	 fcr.relating_shape_aspect,'INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_ASPECT_RELATIONSHIP.RELATING_SHAPE_ASPECT') | 
	 ((SIZEOF(['INTEGRATED_CNC_SCHEMA.CIRCULAR_PATTERN',
	 'INTEGRATED_CNC_SCHEMA.RECTANGULAR_PATTERN'] * 
	 TYPEOF(modsar.related_shape_aspect.of_shape.definition)) = 1) AND 
	 (modsar :<>: fcr)) ) | 
	 (NOT (modfcr.related_shape_aspect.of_shape.definition :=: 
	 SELF.relating_shape_aspect.of_shape.definition)) ))
	  = 0))) )) = 0);
    WR4: (SIZEOF(QUERY ( pd <* USEDIN(SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(USEDIN(pd,'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION')) = 1)) )) = 0);
    WR5: ((NOT ('INTEGRATED_CNC_SCHEMA.CIRCULAR_PATTERN' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition))) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (NOT (SIZEOF(pdr.used_representation.items) = 1)) )) = 0)) )) = 0));
    WR6: ((NOT ('INTEGRATED_CNC_SCHEMA.CIRCULAR_PATTERN' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition))) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND 
	 ('INTEGRATED_CNC_SCHEMA.COUNT_MEASURE' 
	 IN TYPEOF(it\measure_with_unit.value_component)) AND 
	 (it.name = 'index number')) )) = 1)) )) = 0)) )) = 0));
    WR7: ((NOT ('INTEGRATED_CNC_SCHEMA.RECTANGULAR_PATTERN' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition))) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (NOT (SIZEOF(pdr.used_representation.items) = 2)) )) = 0)) )) = 0));
    WR8: ((NOT ('INTEGRATED_CNC_SCHEMA.RECTANGULAR_PATTERN' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition))) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND ('INTEGRATED_CNC_SCHEMA.COUNT_MEASURE' 
	 IN TYPEOF(it\measure_with_unit.value_component)) AND 
	 (it.name = 'row index')) )) = 1)) )) = 0)) )) = 0));
    WR9: ((NOT ('INTEGRATED_CNC_SCHEMA.RECTANGULAR_PATTERN' 
	 IN TYPEOF(SELF.relating_shape_aspect.of_shape.definition))) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF.related_shape_aspect,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND ('INTEGRATED_CNC_SCHEMA.COUNT_MEASURE' 
	 IN TYPEOF(it\measure_with_unit.value_component)) AND 
	 (it.name = 'column index')) )) = 1)) )) = 0)) )) = 0));
END_ENTITY; -- pattern_omit_membership



(* NOT USED BY STEP-NC but included for compatibility with AP-224 *)
ENTITY placed_datum_target_feature
  SUBTYPE OF (datum_target);
  WHERE
  WR1 : (SELF.description IN ['point','line','rectangle','circle']);
  WR2 : (SIZEOF(QUERY ( pd <* USEDIN(SELF,
        'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
        (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
        'INTEGRATED_CNC_SCHEMA.' + 
        'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
        (('INTEGRATED_CNC_SCHEMA.' + 
        'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
        IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0);
  WR3 : (SIZEOF(QUERY ( pd <* USEDIN(SELF,
        'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
        (NOT (SIZEOF(QUERY ( dtm_rep <* QUERY ( pdr <* USEDIN(pd,
        'INTEGRATED_CNC_SCHEMA.' +
        'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
        (('INTEGRATED_CNC_SCHEMA.' + 
        'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
        IN TYPEOF(pdr.used_representation)) ) | 
        (NOT (SIZEOF(QUERY ( it <* dtm_rep.used_representation.items | 
        (('INTEGRATED_CNC_SCHEMA.PLACEMENT' 
        IN TYPEOF(it)) AND (it.name = 'orientation')) )) = 1)) )) 
        = 0)) )) = 0);
  WR4 : ((NOT (SELF.description = 'point')) OR 
        (SIZEOF(QUERY ( pd <*  USEDIN(SELF,
        'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
        (NOT (SIZEOF(QUERY ( dtm_rep <* 
        QUERY ( pdr <* USEDIN(pd,'INTEGRATED_CNC_SCHEMA.' +
        'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
        (('INTEGRATED_CNC_SCHEMA.' + 
        'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
        IN TYPEOF(pdr.used_representation)) ) | 
        (NOT (SIZEOF(dtm_rep.used_representation.items) = 1)) )) 
        = 0)) )) = 0));
  WR5 : ((NOT (SELF.description IN ['line','circle'])) OR 
        (SIZEOF(QUERY ( pd <* USEDIN(SELF,
        'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
        (NOT (SIZEOF(QUERY ( dtm_rep <* QUERY ( pdr <* USEDIN(pd,
        'INTEGRATED_CNC_SCHEMA.' +
        'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
        (('INTEGRATED_CNC_SCHEMA.' + 
        'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
        IN TYPEOF(pdr.used_representation)) ) | 
        (NOT (SIZEOF(dtm_rep.used_representation.items) = 2)) )) 
         = 0)) )) = 0));
  WR6 : ((NOT (SELF.description = 'rectangle')) OR 
        (SIZEOF(QUERY ( pd <* USEDIN(SELF,
        'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
        (NOT (SIZEOF(QUERY ( dtm_rep <* QUERY ( pdr <* USEDIN(pd,
        'INTEGRATED_CNC_SCHEMA.' +
        'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
        (('INTEGRATED_CNC_SCHEMA.' + 
        'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
        IN TYPEOF(pdr.used_representation)) ) | 
        (NOT (SIZEOF(dtm_rep.used_representation.items) = 3)) )) 
        = 0)) )) = 0));
  WR7 : ((NOT (SELF.description = 'circle')) OR 
        (SIZEOF(QUERY ( pd <* USEDIN(SELF,
        'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
        (NOT (SIZEOF(QUERY ( dtm_rep <* QUERY ( pdr <* USEDIN(pd,
        'INTEGRATED_CNC_SCHEMA.' + 
        'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
        (('INTEGRATED_CNC_SCHEMA.' + 
        'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
        IN TYPEOF(pdr.used_representation)) ) | 
        (NOT (SIZEOF(QUERY ( it <* dtm_rep.used_representation.items | 
        ((SIZEOF([
        'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
        'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
        TYPEOF(it)) = 2) AND (it.name = 'target diameter')) )) 
        = 1)) )) = 0)) )) = 0));
  WR8 : ((NOT (SELF.description = 'line')) OR 
        (SIZEOF(QUERY ( pd <* USEDIN(SELF,
        'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
        (NOT (SIZEOF(QUERY ( dtm_rep <* QUERY ( pdr <* USEDIN(pd,
        'INTEGRATED_CNC_SCHEMA.' + 
        'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
        (('INTEGRATED_CNC_SCHEMA.' + 
        'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
        IN TYPEOF(pdr.used_representation)) ) | 
        (NOT (SIZEOF(QUERY ( it <* dtm_rep.used_representation.items | 
        ((SIZEOF([
        'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
        'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
        TYPEOF(it)) = 2) AND (it.name = 'target length')))) = 1)) )) 
        = 0)) )) = 0));
  WR9 : ((NOT (SELF.description = 'rectangle')) OR 
        (SIZEOF(QUERY ( pd <* USEDIN(SELF,
        'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
        (NOT (SIZEOF(QUERY ( dtm_rep <* QUERY ( pdr <* USEDIN(pd,
        'INTEGRATED_CNC_SCHEMA.' + 
        'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
        (('INTEGRATED_CNC_SCHEMA.' + 
        'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
        IN TYPEOF(pdr.used_representation)) ) | 
        (NOT (SIZEOF(QUERY ( it <* dtm_rep.used_representation.items | 
        ((SIZEOF([
        'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
        'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
        TYPEOF(it)) = 2) AND (it.name = 'target length')))) = 1)) )) 
        = 0)) )) = 0));
  WR10: ((NOT (SELF.description = 'rectangle')) OR 
        (SIZEOF(QUERY ( pd <* USEDIN(SELF,
        'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
        (NOT (SIZEOF(QUERY ( dtm_rep <* QUERY ( pdr <* USEDIN(pd,
        'INTEGRATED_CNC_SCHEMA.' + 
        'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
        (('INTEGRATED_CNC_SCHEMA.' + 
        'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
        IN TYPEOF(pdr.used_representation)) ) | 
        (NOT (SIZEOF(QUERY ( it <* dtm_rep.used_representation.items | 
        ((SIZEOF([
        'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
        'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
        TYPEOF(it)) = 2) AND (it.name = 'target width'))))= 1))))
        = 0)) ))=0));
END_ENTITY; -- placed_datum_target_feature


ENTITY planar_shape_representation
  SUBTYPE OF (shape_representation);
  WHERE
    WR1: SIZEOF (SELF.items) = 1;
    WR2: (SIZEOF (QUERY (it <* SELF.items |
	 NOT ('INTEGRATED_CNC_SCHEMA.PLANE' 
	 IN TYPEOF (it)))) = 1) ;
END_ENTITY; 



ENTITY pocket
  SUBTYPE OF (feature_definition);
  WHERE
    WR1: (SELF\characterized_object.description IN 
	 ['closed rectangular','open rectangular', 'complex', 
	 'circular cutout', 'complex cutout', 'recess']);
    WR2: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'pocket depth occurrence') AND
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'path feature component usage')  AND 
	 (sar.name = 'pocket depth') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.PATH_FEATURE_COMPONENT' 
	 IN TYPEOF(sdr.relating_shape_aspect)) AND 
	 (sdr.relating_shape_aspect.description ='linear')) )) 
	 = 1)) )) = 1)) )) = 0);
    WR3: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation))) = 1))) = 0;
    WR4: SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd, 
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) AND
	 ({1 <= SIZEOF(pdr.used_representation.items) <= 2} ) )) = 1 )) = 1;
    WR5: SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd, 
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' IN
	 TYPEOF(pdr.used_representation)) AND
	 (SIZEOF( QUERY( srwp_i <* pdr.used_representation.items |
	 (srwp_i.name = 'orientation') OR
	 (srwp_i.name = 'fillet radius'))) 
	 = SIZEOF(pdr.used_representation.items)) )) = 1 )) = 1;
    WR6: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF (
	 ['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] * 
	 TYPEOF (it)) = 2) AND (it.name = 'fillet radius'))) <= 1))) 
	 = 0))) = 0;
    WR7: ((NOT (SELF\characterized_object.description IN ['complex',
	 'non-circular cutout','recess'])) OR 
	 (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'boundary occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 ((sar.description = 'profile usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.CIRCULAR_CLOSED_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.NGON_CLOSED_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.RECTANGULAR_CLOSED_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.CLOSED_PATH_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.SQUARE_U_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.PARTIAL_CIRCULAR_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.ROUNDED_U_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.VEE_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.TEE_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.OPEN_PATH_PROFILE'] * 
	 TYPEOF(sdr.relating_shape_aspect)) = 1)) )) = 1)) )) 
	 = 1)) )) = 0));
    WR8: ((NOT (SELF\characterized_object.description = 
	 'closed rectangular')) 
	 OR (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'closed boundary occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'profile usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.RECTANGULAR_CLOSED_PROFILE' 
	 IN TYPEOF(sdr.relating_shape_aspect))) )) = 1)) )) 
	 = 1)) )) = 0));
    WR9: ((NOT (SELF\characterized_object.description = 'open rectangular')) 
	 OR (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |  
	 ((sa_occ.description = 'open boundary occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'profile usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.SQUARE_U_PROFILE' 
	 IN TYPEOF(sdr.relating_shape_aspect))) )) = 1)) )) 
	 = 1)) )) = 0));
   WR10: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'bottom condition occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'pocket bottom usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 ('INTEGRATED_CNC_SCHEMA.POCKET_BOTTOM' 
	 IN TYPEOF(sdr.relating_shape_aspect)) )) = 1)) )) = 1)) )) = 0);
   WR11: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'change in boundary occurrence') AND 
	 (SIZEOF(QUERY ( fcr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATING_SHAPE_ASPECT') | 
	 ((sar.description = 'taper usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.TAPER' 
	 IN TYPEOF(fcr.related_shape_aspect)) AND 
	 (fcr.related_shape_aspect.description 
	 IN ['angle taper','directed taper'])) )) = 1)) )) 
	 <= 1)) )) = 0);
   WR12: (NOT (SELF\characterized_object.description = 'circular cutout')) OR 
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' IN
	 TYPEOF (pd)) | NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'enclosed boundary occurrence') AND
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'profile usage') AND
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 ('INTEGRATED_CNC_SCHEMA.CIRCULAR_CLOSED_PROFILE' 
	 IN TYPEOF (sdr.relating_shape_aspect)))) 
	 = 1))) = 1))) = 0);
   WR13: (NOT (SELF\characterized_object.description IN 
	 ['circular cutout','complex cutout'])) OR 
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' IN
	 TYPEOF (pd)) | NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'bottom condition occurrence') AND
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'pocket bottom usage') AND
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 ('INTEGRATED_CNC_SCHEMA.POCKET_BOTTOM' 
	 IN TYPEOF (sdr.relating_shape_aspect)) AND
	 (sdr.relating_shape_aspect.description = 'through'))) 
	 = 1))) = 1))) = 0);
   WR14: (NOT (SELF\characterized_object.description = 'recess')) OR 
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' IN
	 TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'bottom condition occurrence') AND
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'pocket bottom usage') AND
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 ('INTEGRATED_CNC_SCHEMA.POCKET_BOTTOM' 
	 IN TYPEOF (sdr.relating_shape_aspect)) AND
	 (sdr.relating_shape_aspect.description IN ['planar','complex']))) 
	 = 1))) = 1))) = 0);
END_ENTITY; -- pocket 



ENTITY pocket_bottom
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: 'INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF (SELF.of_shape.definition);
    WR2: SELF.description IN ['planar', 'complex', 'through'];
    wr3: ((NOT (SELF.description = 'planar')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.DIRECTION_SHAPE_REPRESENTATION') 
	 IN TYPEOF(pdr.used_representation))  AND 
	 (pdr.used_representation.name = 'floor normal') )) = 1)) )) = 0));
    WR4: ((NOT (SELF.description = 'planar')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.LOCATION_SHAPE_REPRESENTATION') 
	 IN TYPEOF(pdr.used_representation))  AND 
	 (pdr.used_representation.name = 'floor location'))) = 1)) )) = 0));
    WR5: ((NOT (SELF.description = 'complex')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.FACE_SHAPE_REPRESENTATION' 
	 IN TYPEOF(pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'floor face') )) = 1)) )) = 0));
    WR6: (NOT (SELF.description IN  ['planar', 'complex']) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation))) = 1))) = 0));
    WR7: (NOT (SELF.description IN  ['planar', 'complex']) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (impl_rep.used_representation.items) 
	 <= 1) )) = 0))) = 0)); 
    WR8: (NOT (SELF.description = 'through') OR 
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation))) = 0))) = 0));
    WR9: (NOT (SELF.description IN ['planar', 'complex'])) OR 
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] * 
	 TYPEOF (it)) = 2) AND (it.name = 'radius'))) <= 1))) = 0))) = 0);
   WR10: SIZEOF (QUERY (fcr <* QUERY (sar <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATING_SHAPE_ASPECT') | 
	 (sar.description = 'pocket bottom usage') AND
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 (fcr.related_shape_aspect.description = 
	 'bottom condition occurrence') AND
	 ('INTEGRATED_CNC_SCHEMA.POCKET' 
	 IN TYPEOF(fcr.related_shape_aspect.of_shape.definition)))) >= 1;
   WR11: ((NOT (SELF.description IN ['planar','complex'])) OR
	  (SIZEOF (QUERY (fcr <* QUERY (sar <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATING_SHAPE_ASPECT') | 
	 (sar.description = 'pocket bottom usage') AND
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 (fcr.related_shape_aspect.description = 
	 'bottom condition occurrence') AND
	 (fcr.related_shape_aspect.name IN 
	 ['pocket depth start', 'pocket depth end'])
	 )) = 0));
END_ENTITY;  -- pocket_bottom
 


ENTITY profile_floor
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: 'INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF (SELF.of_shape.definition);
    WR2: SELF.description IN ['planar', 'complex', 'through'];
    WR3: (NOT (SELF.description IN ['planar', 'complex']) OR 
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation))) = 1))) = 0));
    WR4: (NOT (SELF.description IN  ['planar', 'complex'])) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (impl_rep.used_representation.items) >= 1)AND
	 (SIZEOF (impl_rep.used_representation.items) <= 2))) = 0))) = 0); 
    WR5: (NOT (SELF.description = 'through') OR 
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation))) = 0))) = 0));
    WR6: (NOT (SELF.description IN ['planar', 'complex'])) OR 
	 (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] * 
	 TYPEOF (it)) = 2) AND (it.name = 'radius'))) = 1))) = 0))) = 0);
    WR7: SIZEOF (QUERY (fcr <* QUERY (sar <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATING_SHAPE_ASPECT') | 
	 (sar.description = 'profile floor usage') AND
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' IN
	 TYPEOF (sar))) |
	 'INTEGRATED_CNC_SCHEMA.OUTSIDE_PROFILE' IN TYPEOF
	 (fcr.related_shape_aspect.of_shape.definition))) >= 1;
    WR8: ((NOT (SELF.description IN ['planar','complex'])) OR
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION')
	 | (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | ((
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') IN TYPEOF(pdr.
	 used_representation)) ) | (NOT (SIZEOF(QUERY ( it <* 
	 impl_rep.used_representation.items | 
	 (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM'
	 IN TYPEOF(it)) AND (it.name = 'shape profile floor orientation') 
	 AND (it.description IN ['shape profile start','shape profile end']))
	 )) =  1)) )) = 0)) )) = 0));
    WR9: (NOT (SELF.description = 'complex')) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.FACE_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation))  AND 
	 (pdr.used_representation.name='floor'))) = 1))) = 1);
   WR10: (NOT (SELF.description = 'planar')) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.PLANAR_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation))  AND 
	 (pdr.used_representation.name='floor'))) = 1))) = 1);
END_ENTITY;  -- profile_floor


(* NOT USED BY STEP-NC but included for compatibility with AP-224 *)
ENTITY protrusion
  SUBTYPE OF (feature_definition);
  WHERE
    WR1: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 1)) )) 
	 = 0)) )) = 0);
    WR2: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'shape volume occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'volume shape usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (sdr.relating_shape_aspect.description = 'volume shape') )) = 1)) )) 
	 = 1)) )) = 0);
END_ENTITY; -- protrusion


ENTITY rectangular_closed_profile
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: 'INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF (SELF.of_shape.definition);
    WR2: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation))) = 1))) = 0;
    WR3: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT ((SIZEOF (impl_rep.used_representation.items) >= 3)  
	 AND (SIZEOF(impl_rep.used_representation.items) <= 4)))) = 0))) = 0;
    WR4: SIZEOF( QUERY( pd <* USEDIN( SELF,'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd, 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) AND
	 (SIZEOF( QUERY( srwp_i <* pdr.used_representation.items |
	 (srwp_i.name = 'orientation') OR
	 (srwp_i.name = 'length') OR
	 (srwp_i.name = 'width') OR
	 (srwp_i.name = 'corner radius') )) =
	 SIZEOF(pdr.used_representation.items))
	 )) = 1 )) = 1;
    WR5: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 ('INTEGRATED_CNC_SCHEMA.PLACEMENT' IN TYPEOF (it)) AND 
	 (it.name = 'orientation'))) = 1))) = 0))) = 0;
    WR6: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *	
	 TYPEOF (it)) = 2) AND 
	 (it.name = 'width'))) = 1))) = 0))) = 0;
    WR7: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *	
	 TYPEOF (it)) = 2) AND 
	 (it.name = 'length'))) = 1))) = 0))) = 0;
    WR8: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *	
	 TYPEOF (it)) = 2) AND 
	 (it.name = 'corner radius'))) <= 1))) = 0))) = 0;
END_ENTITY;  -- rectangular_closed_profile


ENTITY rectangular_pattern
  SUBTYPE OF (replicate_feature);
  WHERE
    WR1: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN
	 (pds,'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' 
	 + 'RELATING_SHAPE_ASPECT') | 
	 ((('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT' 
	 IN TYPEOF(sdr.related_shape_aspect)) )) = 1)) )) <= 5)) )) = 0);
    WR2: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 (('INTEGRATED_CNC_SCHEMA.DIRECTION_SHAPE_REPRESENTATION' 
	 IN TYPEOF(pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'row layout direction') ) )) 
	 = 1)) ))  = 0);
    WR3: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.DIRECTION_SHAPE_REPRESENTATION' 
	 IN TYPEOF(pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'column layout direction')) )) 
	 = 1)) )) = 0);
    WR4: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.' + 
	 'DEFINITION') | (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0);
    WR5: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 5)) )) 
	 = 0)) )) = 0);
    WR6: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND 
	 ('INTEGRATED_CNC_SCHEMA.COUNT_MEASURE' 
	 IN TYPEOF(it\measure_with_unit.value_component)) AND 
	 (it.name = 'number of rows')) )) = 1)) )) = 0)) )) = 0);
    WR7: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND 
	 ('INTEGRATED_CNC_SCHEMA.COUNT_MEASURE' 
	 IN TYPEOF(it\measure_with_unit.value_component)) AND 
	 (it.name = 'number of columns')) )) = 1)) )) = 0)) )) = 0);
    WR8: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN( pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'row spacing')) )) = 1)) )) 
	 = 0)) )) = 0);
    WR9: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'column spacing'))))= 1)) )) 
	 = 0)) )) = 0);
   wr10: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 (('INTEGRATED_CNC_SCHEMA.PLACEMENT' IN TYPEOF(it)) AND 
	 (it.name = 'orientation')) )) = 1)) )) = 0)) )) = 0);
END_ENTITY; -- rectangular_pattern



ENTITY removal_volume
  SUBTYPE OF (feature_definition);
  WHERE
    WR1: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 1)) )) 
	 = 0)) )) = 0);
    WR2: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'shape volume occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' 
	 + 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'volume shape usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (sdr.relating_shape_aspect.description = 'volume shape') )) = 1)) )) 
	 = 1)) )) = 0);
END_ENTITY; -- removal_volume


ENTITY replicate_feature
  SUPERTYPE OF (ONEOF (circular_pattern, rectangular_pattern, feature_pattern))
  SUBTYPE OF (feature_definition);
  WHERE
    WR1: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION')
	 | (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | ((
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') IN TYPEOF(pdr.
	 used_representation)) ))  = 1)) )) = 0);
    WR2: (SIZEOF(QUERY ( fcr <* QUERY ( sar <* 
	 USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' 
	 + 'RELATING_SHAPE_ASPECT') | 
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(sar)) ) | 
	 ((SIZEOF(['INTEGRATED_CNC_SCHEMA.REPLICATE_FEATURE',
	 'INTEGRATED_CNC_SCHEMA.INSTANCED_FEATURE'] * 
	 TYPEOF(fcr.related_shape_aspect)) >= 1) AND 
	 (fcr.name = 'pattern basis')) )) = 1);
    WR3: ((SIZEOF(QUERY ( sar <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' 
	 + 'RELATING_SHAPE_ASPECT') | 
	 (NOT
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(sar))) )) + 
	 SIZEOF(QUERY ( sar <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' 
	 + 'RELATED_SHAPE_ASPECT') | 
	 (NOT
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(sar))) ))) = 0);
END_ENTITY;  -- replicate_feature


(* NOT USED BY STEP-NC but included for compatibility with AP-224 *)
ENTITY revolved_profile
  SUBTYPE OF (feature_definition);
  WHERE
    WR1: (SELF\characterized_object.description IN 
	 ['groove','flat','round','open profile']);
    WR2: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 2)) )) 
	 = 0)) )) = 0);
    WR3: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'radius')))) = 1)) )) 
	 = 0)) )) = 0);
    WR4: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 (('INTEGRATED_CNC_SCHEMA.DIRECTION_SHAPE_REPRESENTATION' 
	 IN TYPEOF(pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'removal direction')) )) = 1)) )) 
	 = 0);
    WR5: ((NOT (SELF\characterized_object.description = 'open profile')) OR
	 (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'outer edge shape occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'profile usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.OPEN_PATH_PROFILE' 
	 IN TYPEOF(sdr.relating_shape_aspect)) AND 
	 (sdr.relating_shape_aspect.description = 'outer edge shape')) )) 
	 = 1)) )) = 1)) )) = 0));
    WR6: (NOT (SELF\characterized_object.description = 'flat')) OR 
	 (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION')|
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 (( sa_occ.description = 'flat edge shape occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'profile usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.LINEAR_PROFILE' 
	 IN TYPEOF(sdr.relating_shape_aspect)) AND 
	 (sdr.relating_shape_aspect.description = 'flat edge shape')) )) 
	 = 1)) )) = 1)) )) = 0);
    WR7: ((NOT (SELF\characterized_object.description = 'round')) OR 
	 (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'rounded edge shape occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'profile usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.PARTIAL_CIRCULAR_PROFILE' 
	 IN TYPEOF(sdr.relating_shape_aspect)) AND 
	 (sdr.relating_shape_aspect.description = 'rounded edge shape')) )) 
	 = 1)) )) = 1)) )) = 0));
    WR8: ((NOT (SELF\characterized_object.description = 'groove')) OR 
	 (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'sweep occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'profile usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 ((SIZEOF(['INTEGRATED_CNC_SCHEMA.SQUARE_U_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.PARTIAL_CIRCULAR_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.ROUNDED_U_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.VEE_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.TEE_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.OPEN_PATH_PROFILE'] * 
	 TYPEOF(sdr.relating_shape_aspect)) = 1) AND 
	 (sdr.relating_shape_aspect.description = 'sweep')) )) = 1)) )) 
	 = 1)) )) = 0));
END_ENTITY; -- revolved_profile


(* NOT USED BY STEP-NC but included for compatibility with AP-224 *)
ENTITY rib_top
  SUBTYPE OF (feature_definition);
  WHERE
    WR1: SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'rib top condition occurrence') AND
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'rib top usage') AND
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 'INTEGRATED_CNC_SCHEMA.RIB_TOP_FLOOR' 
	 IN TYPEOF (sdr.relating_shape_aspect))) = 1))) = 1))) = 0;
    WR2: SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.DIRECTION_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation))AND
	 (pdr.used_representation.name = 'removal direction'))) = 1))) = 1;
END_ENTITY;  -- rib_top

(* NOT USED BY STEP-NC but included for compatibility with AP-224 *)
ENTITY rib_top_floor
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: 'INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' IN
	 TYPEOF (SELF.of_shape.definition);
    WR2: SELF.description IN ['planar', 'complex'];
    WR3: SIZEOF (QUERY (fcr <* QUERY (sar <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATING_SHAPE_ASPECT') | 
	 (sar.description = 'rib top usage') AND
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 (fcr.related_shape_aspect.description = 
	 'rib top condition occurrence') 
	 AND
	 ('INTEGRATED_CNC_SCHEMA.RIB_TOP' IN TYPEOF
	 (fcr.related_shape_aspect.of_shape.definition)))) >= 1;
    WR4: (NOT (SELF.description = 'complex')) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.FACE_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation))AND
	 (pdr.used_representation.name = 'rib top face'))) = 1))) = 0);
    WR5: (NOT (SELF.description = 'planar')) OR
	 (SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.PLANAR_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation))AND
	 (pdr.used_representation.name = 'rib top face'))) = 1))) = 0);
    WR6: (NOT (SELF.description = 'planar')) OR
	 (SIZEOF (QUERY (pds <* QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF (pd)) | 
	 NOT (SIZEOF (QUERY (sa_occ <* USEDIN (pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') |
	 (sa_occ.description = 'boundary occurrence') AND
	 (SIZEOF (QUERY (sdr <* QUERY (sar <* USEDIN (sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') |
	 (sar.description = 'profile usage') AND
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP' 
	 IN TYPEOF (sar))) |
	 (SIZEOF (['INTEGRATED_CNC_SCHEMA.CIRCULAR_CLOSED_PROFILE', 
	 'INTEGRATED_CNC_SCHEMA.NGON_CLOSED_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.RECTANGULAR_CLOSED_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.CLOSED_PATH_PROFILE'] *
	 TYPEOF (sdr.relating_shape_aspect)) = 1) AND
	 (sdr.relating_shape_aspect.description = 'rib top floor boundary'))) 
	 = 1))) = 1))) = 0);
END_ENTITY;  -- rib_top_floor



ENTITY round_hole
  SUBTYPE OF (feature_definition);
  WHERE
    WR1: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION')|
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'diameter occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'profile usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.CIRCULAR_CLOSED_PROFILE' 
	 IN TYPEOF(sdr.relating_shape_aspect)) AND 
	 (sdr.name = 'diameter'))  )) = 1)) )) = 1)) )) = 0);
    WR2: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'hole depth occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'path feature component usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.PATH_FEATURE_COMPONENT' 
	 IN TYPEOF(sdr.relating_shape_aspect)) AND 
	 (sdr.name = 'hole depth') AND 
	 (sdr.relating_shape_aspect.description = 'linear')) )) = 1)) )) 
	 = 1)) )) = 0);
    WR3: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'bottom condition occurrence') AND 
	 (SIZEOF(QUERY ( fcr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'hole bottom usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 ('INTEGRATED_CNC_SCHEMA.HOLE_BOTTOM' 
	 IN TYPEOF(fcr.relating_shape_aspect)) )) = 1)) )) = 1)) )) = 0);
    WR4: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'change in diameter occurrence') AND 
	 (SIZEOF(QUERY ( fcr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'taper usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 ('INTEGRATED_CNC_SCHEMA.TAPER' 
	 IN TYPEOF(fcr.relating_shape_aspect)) )) = 1)) )) <= 1)) )) = 0);
    WR5: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation))) = 1))) = 0;
END_ENTITY; -- round_hole



ENTITY rounded_end
  SUBTYPE OF (feature_definition);
  WHERE
    WR1: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 1)) )) 
	 = 0)) )) = 0);
    WR2: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'partial circular boundary occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'profile usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.PARTIAL_CIRCULAR_PROFILE' 
	 IN TYPEOF(sdr.relating_shape_aspect)) ) )) = 1)) )) = 1)) )) = 0);
    WR3: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'course of travel occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'path feature component usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.PATH_FEATURE_COMPONENT' 
	 IN TYPEOF(sdr.relating_shape_aspect)) AND 
	 (sdr.relating_shape_aspect.description = 'linear')) )) = 1)) )) 
	 = 1)) )) = 0);
END_ENTITY; -- rounded_end


ENTITY rounded_u_profile
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF(SELF.of_shape.definition));
    WR2: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0);
    WR3: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF (impl_rep.used_representation.items) = 2)) )) 
	 = 0)) )) = 0);
    WR4: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 (('INTEGRATED_CNC_SCHEMA.PLACEMENT' 
	 IN TYPEOF(it)) AND (it.name = 'orientation')) )) = 1)) )) 
	 = 0)) )) = 0);
    WR5: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'width'))))= 1))))= 0))))= 0);
    WR6: SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.PLANAR_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation))AND
	 (pdr.used_representation.name = 'profile limit'))) <= 1))) = 0;
END_ENTITY; -- rounded_u_profile


ENTITY shape_defining_relationship
  SUBTYPE OF (shape_aspect_relationship);
END_ENTITY;


ENTITY shape_representation_with_parameters
  SUBTYPE OF (shape_representation);
  WHERE
    WR1: (SIZEOF(QUERY ( it <* SELF.items | 
	 (NOT (SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.PLACEMENT',
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM'] *
	 TYPEOF(it)) = 1)) )) = 0);
END_ENTITY; -- shape_representation_with_parameters


ENTITY slot
  SUBTYPE OF (feature_definition);
  WHERE
    WR1: (SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) | 
	 (NOT (SIZEOF (impl_rep.used_representation.items) = 1) ) )) 
	 = 0))) = 0);
    WR2: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'swept shape occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'profile usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 ((SIZEOF(['INTEGRATED_CNC_SCHEMA.SQUARE_U_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.PARTIAL_CIRCULAR_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.ROUNDED_U_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.VEE_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.TEE_PROFILE',
	 'INTEGRATED_CNC_SCHEMA.OPEN_PATH_PROFILE'] * 
	 TYPEOF(sdr.relating_shape_aspect)) = 1)) )) = 1)) )) 
	 = 1)) )) = 0);
    WR3: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'course of travel occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'path feature component usage') AND 
	 ((sar.name = 'course of travel') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) )) | 
	 ('INTEGRATED_CNC_SCHEMA.PATH_FEATURE_COMPONENT' 
	 IN TYPEOF(sdr.relating_shape_aspect)) )) = 1)) )) = 1)) )) = 0);
    WR4: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'end condition occurrence') AND 
	 (SIZEOF(QUERY ( fcr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'slot end usage') AND 
	 (sar.name IN ['course of travel start','course of travel end']) AND 
	 (('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.SLOT_END' 
	 IN TYPEOF(fcr.relating_shape_aspect)) )  )) 
	 = 1)) )) = 2)) )) = 0);
END_ENTITY; -- slot  


ENTITY slot_end
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF(SELF.of_shape.definition));
    WR2: (SELF.description IN ['open','radiused','flat','woodruff']);
    WR3: ((NOT (SELF.description IN ['open','radiused'])) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) )) = 0)) )) = 0));
    WR4: ((NOT (SELF.description IN ['flat','woodruff'])) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0));
    WR5: ((NOT (SELF.description IN ['flat'])) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 2)) )) 
	  = 0)) )) = 0));
    WR6: ((NOT (SELF.description = 'flat')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'first radius')) )) = 1)) )) 
	 = 0)) )) = 0));
    WR7: ((NOT (SELF.description = 'flat')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'second radius')))) = 1)) )) 
	 = 0)) )) = 0));
    WR8: ((NOT (SELF.description = 'woodruff')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 (('INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT' 
	 IN TYPEOF(it)) AND (it.name = 'radius')) )) = 1)) )) 
	 = 0)) )) = 0));
    WR9: ((NOT (SELF.description IN ['woodruff'])) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 1)) )) 
	 = 0)) )) = 0));
   WR10: (SIZEOF(QUERY ( fcr <* QUERY ( sar <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATING_SHAPE_ASPECT') | 
	 ((sar.description = 'slot end usage') AND
	 (sar.name IN ['course of travel start','course of travel end']) AND 
	 ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_RELATIONSHIP' 
	 IN TYPEOF(sar))) ) | 
	 ((fcr.related_shape_aspect.description='end condition occurrence') 
	 AND 
	 ('INTEGRATED_CNC_SCHEMA.SLOT' 
	 IN TYPEOF(fcr.related_shape_aspect.of_shape.definition))) )) 
	 >= 1);
END_ENTITY; -- slot_end


ENTITY spherical_cap
  SUBTYPE OF (feature_definition);
  WHERE
    WR1: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 3)) )) 
	 = 0)) )) = 0);
    WR2: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'radius')) )) = 1)))) 
	 = 0)) )) = 0);
    WR3: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'internal angle')))) = 1)) )) 
	 = 0)) )) = 0);
END_ENTITY; -- spherical_cap


ENTITY square_u_profile
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: 'INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF (SELF.of_shape.definition);
    WR2: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation))) = 1))) = 0;
    WR3: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 (NOT (SIZEOF (impl_rep.used_representation.items) >= 4)
	 AND  (SIZEOF (impl_rep.used_representation.items) <= 6)))) 
	 = 0))) = 0; 
    WR4: SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd, 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) AND
	 (SIZEOF( QUERY( srwp_i <* pdr.used_representation.items |
	 (srwp_i.name = 'orientation') OR
	 (srwp_i.name = 'width') OR
	 (srwp_i.name = 'first angle') OR
	 (srwp_i.name = 'second angle') OR
	 (srwp_i.name = 'first radius') OR
	 (srwp_i.name = 'second radius') OR
	 (srwp_i.name = 'profile limit') )) 
	  = SIZEOF(pdr.used_representation.items)) )) = 1 )) = 1;
    WR5: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 ('INTEGRATED_CNC_SCHEMA.PLACEMENT' IN TYPEOF (it)) AND 
	 (it.name = 'orientation'))) = 1))) = 0))) = 0;
    WR6: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *	
	 TYPEOF (it)) = 2) AND 
	 (it.name = 'width'))) = 1))) = 0))) = 0;
    WR7: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *	
	 TYPEOF (it)) = 2) AND 
	 (it.name = 'first radius'))) <= 1))) = 0))) = 0;
    WR8: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *	
	 TYPEOF (it)) = 2) AND 
	 (it.name = 'second radius'))) <= 1))) = 0))) = 0;
    WR9: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *    
	 TYPEOF (it)) = 2) AND 
	 (it.name = 'first angle'))) = 1))) = 0))) = 0;
   WR10: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *    
	 TYPEOF (it)) = 2) AND 
	 (it.name = 'second angle'))) = 1))) = 0))) = 0;
   WR11: SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.' +
	 'DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.PLANAR_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation))AND
	 (pdr.used_representation.name = 'profile limit'))) <= 1))) = 0;
END_ENTITY; -- square_u_profile


ENTITY step
  SUBTYPE OF (feature_definition);
  WHERE
    WR1: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 1)) )) 
	 = 0)) )) = 0);
    WR2: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'course of travel occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'path feature component usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 (('INTEGRATED_CNC_SCHEMA.PATH_FEATURE_COMPONENT' 
	 IN TYPEOF(sdr.relating_shape_aspect)) AND 
	 (sdr.relating_shape_aspect.description = 'linear')) )) = 1)) )) 
	 = 1)) )) = 0);
    WR3: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'removal boundary occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'profile usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 ('INTEGRATED_CNC_SCHEMA.VEE_PROFILE' 
	 IN TYPEOF(sdr.relating_shape_aspect)) )) = 1)) )) = 1)) )) = 0);
END_ENTITY; -- step


ENTITY taper
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: ('INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF(SELF.of_shape.definition));
    WR2: (SELF.description IN ['angle taper','diameter taper',
	 'directed taper']);
    WR3: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) )) = 1)) )) = 0);
    WR4: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(impl_rep.used_representation.items) = 1)) )) 
	 = 0)) )) = 0);
    WR5: ((NOT (SELF.description = 'angle taper')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'taper angle')) )) = 1)) )) 
	 = 0)) )) = 0));
    WR6: ((NOT (SELF.description = 'diameter taper')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'final diameter')) )) = 1)) )) 
	 = 0)) )) = 0));
    WR7: ((NOT (SELF.description = 'directed taper')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'angle')) )) = 1)) )) 
	 = 0)) )) = 0));
    WR8: ((NOT (SELF.description = 'directed taper')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.DIRECTION_SHAPE_REPRESENTATION' 
	 IN TYPEOF(pdr.used_representation)) AND 
	 (pdr.used_representation.name = 'direction') )) 
	 = 1)) )) = 0));
END_ENTITY; -- taper


ENTITY tee_profile
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: 'INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF (SELF.of_shape.definition);
    WR2: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation))) = 1))) = 0;
    WR3: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 (NOT (SIZEOF (impl_rep.used_representation.items) >= 9)
	 AND  (SIZEOF (impl_rep.used_representation.items) <= 10)))) 
	 = 0))) = 0; 
    WR4: SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) AND
	 (SIZEOF( QUERY( srwp_i <* pdr.used_representation.items |
	 (srwp_i.name = 'orientation') OR
	 (srwp_i.name = 'width') OR
	 (srwp_i.name = 'depth') OR
	 (srwp_i.name = 'cross bar width') OR
	 (srwp_i.name = 'cross bar depth') OR
	 (srwp_i.name = 'first offset') OR
	 (srwp_i.name = 'second offset') OR
	 (srwp_i.name = 'first angle') OR
	 (srwp_i.name = 'second angle') OR
	 (srwp_i.name = 'radius') )) 
	 = SIZEOF(pdr.used_representation.items)) )) = 1 )) = 1;
    WR5: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 ('INTEGRATED_CNC_SCHEMA.PLACEMENT' IN TYPEOF (it)) AND 
	 (it.name = 'orientation'))) = 1))) = 0))) = 0;
    WR6: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *	
	 TYPEOF (it)) = 2) AND	(it.name = 'width'))) = 1))) = 0))) = 0;
    WR7: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *	
	 TYPEOF (it)) = 2) AND (it.name = 'depth'))) = 1))) = 0))) = 0;
    WR8: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *	
	 TYPEOF (it)) = 2) AND (it.name = 'cross bar width'))) = 1))) 
	 = 0))) = 0;
    WR9: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *	
	 TYPEOF (it)) = 2) AND (it.name = 'cross bar depth'))) = 1))) 
	 = 0))) = 0;
   WR10: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *	
	 TYPEOF (it)) = 2) AND (it.name = 'first offset'))) = 1))) 
	 = 0))) = 0;
   WR11: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *	
	 TYPEOF (it)) = 2) AND (it.name = 'second offset'))) = 1))) 
	 = 0))) = 0;
   WR12: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *    
	 TYPEOF (it)) = 2) AND (it.name = 'first angle'))) = 1))) 
	 = 0))) = 0;
   WR13: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *    
	 TYPEOF (it)) = 2) AND (it.name = 'second angle'))) = 1))) 
	 = 0))) = 0;
   WR14: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *	
	 TYPEOF (it)) = 2) AND (it.name = 'radius'))) <= 1))) = 0))) = 0;
   WR15: SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.' +
	 'DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.PLANAR_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation))AND
	 (pdr.used_representation.name = 'profile limit'))) <= 1))) = 0;
END_ENTITY;  -- tee_profile


ENTITY thread
  SUBTYPE OF (feature_definition);
  WHERE
    WR1: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (SIZEOF(QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 ((('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) AND 
	 (8 <= SIZEOF(pdr.used_representation.items)) AND 
	 (SIZEOF(pdr.used_representation.items) <= 11)) )) = 1) )) = 1);
    WR2: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN( pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |     
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] 
	 * TYPEOF(it)) = 2) AND (it.name = 'major diameter')) )) = 1)) )) 
	 = 0)) )) = 0);
    WR3: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] 
	 * TYPEOF(it)) = 2) AND (it.name = 'minor diameter')) )) 
	 <= 1)) )) = 0)) )) = 0);
    WR4: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN( pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] 
	 * TYPEOF(it)) = 2) AND (it.name = 'pitch diameter')) )) = 1)) )) 
	 = 0)) )) = 0);
    WR5: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.RATIO_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'number of threads')) )) 
	 = 1)) )) = 0)) )) = 0);
    WR6: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN( pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND (it.name = 'fit class')) )) = 1)) )) = 0)) )) 
	 = 0);
    WR7: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND (it.name = 'form')) )) = 1)) )) = 0)) )) 
	 = 0);
    WR8: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN( pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND (it.name = 'hand')AND 
	 (it.description IN ['left', 'right']) ) )) = 1)) )) = 0)) )) 
	 = 0);
    WR9: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND (it.name = 'qualifier')) )) <= 1)) )) 
	 = 0)) )) = 0);
   WR10: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN( pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND (it.name = 'thread side') AND 
	 ((it.description = 'internal') OR (it.description = 'external'))) )) 
	 = 1)) )) = 0)) )) = 0);
   WR11: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] 
	 * TYPEOF(it)) = 2) AND (it.name = 'crest')) )) <= 1)) )) 
	 = 0)) )) = 0);
   WR12: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | 
	 (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'partial area occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' 
	 + 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'applied area usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 ('INTEGRATED_CNC_SCHEMA.APPLIED_AREA' 
	 IN TYPEOF(sdr.relating_shape_aspect)) )) = 1)) )) = 1)) )) = 0);
   WR13: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | 
	 (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' 
	 + 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'applied shape') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT' 
	 IN TYPEOF(sdr.relating_shape_aspect)) )) = 1)) )) = 1)) )) = 0);
END_ENTITY;  -- thread


ENTITY transition_feature
  SUPERTYPE OF (ONEOF (chamfer,edge_round,fillet))
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1:  SIZEOF(['INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION',
		 'INTEGRATED_CNC_SCHEMA.COMPOUND_FEATURE']
		 * TYPEOF(SELF.of_shape.definition)) = 1;
    WR2:  SIZEOF(['INTEGRATED_CNC_SCHEMA.CHAMFER',
		  'INTEGRATED_CNC_SCHEMA.EDGE_ROUND', 
		  'INTEGRATED_CNC_SCHEMA.FILLET'] *
	  TYPEOF(SELF)) = 1;
END_ENTITY; -- transition_feature

(* NOT USED BY STEP-NC but included for compatibility with AP-224 *)
ENTITY turned_knurl
  SUBTYPE OF (feature_definition);
  WHERE
   WR1: (SELF\characterized_object.description IN
	 ['diamond','diagonal','straight']);
    WR2: SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd, 
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' IN
	 TYPEOF(pdr.used_representation)) AND
	 ({6 <= SIZEOF(pdr.used_representation.items) <= 9}) )) = 1 )) = 1;
    WR3: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND 
	 ('INTEGRATED_CNC_SCHEMA.COUNT_MEASURE' 
	 IN TYPEOF(it\measure_with_unit.value_component)) AND 
	 (it.name = 'number of teeth')) )) <= 1)) )) = 0)) )) = 0);
    WR4: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' 
	 + 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] 
	 * TYPEOF(it)) = 2) AND (it.name = 'major diameter'))))= 1)) )) 
	 = 0)) )) = 0);
    WR5: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' 
	 + 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] 
	 * TYPEOF(it)) = 2) AND (it.name = 'nominal diameter')) )) = 1)) )) 
	 = 0)) )) = 0);
    WR6: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.' + 
	 'DEFINITION') | (NOT (SIZEOF(QUERY ( impl_rep <* 
	 QUERY ( pdr <* USEDIN(pd,'INTEGRATED_CNC_SCHEMA.' 
	 + 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | ((
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') IN TYPEOF(pdr.
	 used_representation)) ) | (NOT (SIZEOF(QUERY ( it <* 
	 impl_rep.used_representation.items | ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] 
	 * TYPEOF(it)) = 2) AND (it.name = 'tooth depth')) )) <= 1)) )) 
	 = 0)) )) = 0);
    WR7: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'root fillet')) )) <= 1)) )) 
	 = 0)) )) = 0);
    WR8: (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items | 
	 ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT'] *
	 TYPEOF(it)) = 2) AND (it.name = 'diametral pitch')) )) = 1)) )) 
	 = 0)) )) = 0);
    WR9: ((NOT (SELF\characterized_object.description IN
	 ['diamond','diagonal'])) OR (
	 SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION')
	 | (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(
	 pd,'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | ((
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') IN TYPEOF(pdr.
	 used_representation)) ) | (NOT (SIZEOF(QUERY ( it <* 
	 impl_rep.used_representation.items | ((SIZEOF([
	 'INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] 
	 * TYPEOF(it)) = 2) AND (it.name = 'helix angle')) )) = 1)) )) 
	 = 0)) )) = 0));
   WR10: ((NOT (SELF\characterized_object.description = 'diagonal')) OR 
	 (SIZEOF(QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 (NOT (SIZEOF(QUERY ( impl_rep <* QUERY ( pdr <* USEDIN(pd,
	 'INTEGRATED_CNC_SCHEMA.' + 
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS') 
	 IN TYPEOF(pdr.used_representation)) ) | 
	 (NOT (SIZEOF(QUERY ( it <* impl_rep.used_representation.items |
	 (('INTEGRATED_CNC_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' 
	 IN TYPEOF(it)) AND (it.name = 'helix hand')) )) = 1)) )) 
	 = 0)) )) = 0));
   WR11: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((sa_occ.description = 'partial area occurrence') AND 
	 (SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' +
	 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'applied area usage') AND 
	 (('INTEGRATED_CNC_SCHEMA.' + 
	 'SHAPE_DEFINING_RELATIONSHIP') IN TYPEOF(sar))) ) | 
	 ('INTEGRATED_CNC_SCHEMA.APPLIED_AREA' 
	 IN TYPEOF(sdr.relating_shape_aspect)) )) = 1)) )) = 1)) )) = 0);
   WR12: (SIZEOF(QUERY ( pds <* QUERY ( pd <* USEDIN(SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 
	 ('INTEGRATED_CNC_SCHEMA.PRODUCT_DEFINITION_SHAPE' 
	 IN TYPEOF(pd)) ) | 
	 (NOT (SIZEOF(QUERY ( sa_occ <* USEDIN(pds,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT.OF_SHAPE') | 
	 ((SIZEOF(QUERY ( sdr <* QUERY ( sar <* USEDIN(sa_occ,
	 'INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT_RELATIONSHIP.' 
	 + 'RELATED_SHAPE_ASPECT') | 
	 ((sar.description = 'applied shape') AND 
	 (('INTEGRATED_CNC_SCHEMA.SHAPE_DEFINING_RELATIONSHIP') 
	 IN TYPEOF(sar))) ) | 
	 ('INTEGRATED_CNC_SCHEMA.SHAPE_ASPECT' 
	 IN TYPEOF(sdr.relating_shape_aspect)) )) = 1)) )) = 1)) )) = 0);
END_ENTITY; -- turned_knurl



ENTITY vee_profile
  SUBTYPE OF (shape_aspect);
  WHERE
    WR1: 'INTEGRATED_CNC_SCHEMA.FEATURE_COMPONENT_DEFINITION' 
	 IN TYPEOF (SELF.of_shape.definition);
    WR2: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation))) = 1))) = 0;
    WR3: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 (NOT (SIZEOF (impl_rep.used_representation.items) >= 3)
	 AND  (SIZEOF (impl_rep.used_representation.items) <= 4)))) 
	 = 0))) = 0;
    WR4: SIZEOF( QUERY( pd <* USEDIN( SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 SIZEOF( QUERY( pdr <* USEDIN( pd, 
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.'+
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS' 
	 IN TYPEOF(pdr.used_representation)) AND
	 (SIZEOF( QUERY( srwp_i <* pdr.used_representation.items |
	 (srwp_i.name = 'orientation') OR
	 (srwp_i.name = 'profile angle') OR
	 (srwp_i.name = 'tilt angle') OR
	 (srwp_i.name = 'profile radius') )) 
	 = SIZEOF(pdr.used_representation.items)) )) = 1 )) = 1;
    WR5: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 ('INTEGRATED_CNC_SCHEMA.PLACEMENT' IN TYPEOF (it)) AND 
	 (it.name = 'orientation'))) = 1))) = 0))) = 0;
    WR6: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 ('INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM' 
	 IN TYPEOF (it)) AND 
	 ('INTEGRATED_CNC_SCHEMA.LENGTH_MEASURE_WITH_UNIT' 
	 IN TYPEOF (it\measure_with_unit.value_component)) AND 
	 (it.name = 'profile radius'))) <= 1))) = 0))) = 0;
    WR7: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *    
	 TYPEOF (it)) = 2) AND 
	 (it.name = 'profile angle'))) = 1))) = 0))) = 0;
    WR8: SIZEOF (QUERY (pd <* USEDIN (SELF, 
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (impl_rep <* QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 'INTEGRATED_CNC_SCHEMA.' +
	 'SHAPE_REPRESENTATION_WITH_PARAMETERS'
	 IN TYPEOF (pdr.used_representation)) |
	 NOT (SIZEOF (QUERY (it <* impl_rep.used_representation.items |
	 (SIZEOF 
	 (['INTEGRATED_CNC_SCHEMA.MEASURE_REPRESENTATION_ITEM',
	 'INTEGRATED_CNC_SCHEMA.PLANE_ANGLE_MEASURE_WITH_UNIT'] *    
	 TYPEOF (it)) = 2) AND 
	 (it.name = 'tilt angle'))) = 1))) = 0))) = 0;
    WR9: SIZEOF (QUERY (pd <* USEDIN (SELF,
	 'INTEGRATED_CNC_SCHEMA.PROPERTY_DEFINITION.DEFINITION') |
	 NOT (SIZEOF (QUERY (pdr <* USEDIN (pd,
	 'INTEGRATED_CNC_SCHEMA.' +
	 'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') |
	 ('INTEGRATED_CNC_SCHEMA.PLANAR_SHAPE_REPRESENTATION'
	 IN TYPEOF (pdr.used_representation))AND
	 (pdr.used_representation.name = 'profile limit'))) <= 1))) = 0;
END_ENTITY;  -- vee_profile




(* ========================================  *)
(* GLOBAL RULES *)

RULE application_context_requires_ap_definition FOR 
  (application_context, application_protocol_definition);
WHERE
  WR1:  (0 = SIZEOF (QUERY (ac <* application_context | NOT
           (1 = SIZEOF (QUERY (apd <* application_protocol_definition | 
                (apd.application :=: ac) AND
                (apd.application_interpreted_model_schema_name =   
                 'integrated_cnc_schema'))))
        )));
END_RULE;


RULE approval_requires_approval_date_time FOR 
  (approval, approval_date_time);
WHERE
  WR1:  (0 = SIZEOF (QUERY (app <* approval | NOT
           (1 = SIZEOF (QUERY (adt <* approval_date_time |
               (app :=: adt.dated_approval))))
        )));
END_RULE;


RULE approval_requires_approval_person_organization FOR 
  (approval, approval_person_organization);
WHERE
  WR1:  (0 = SIZEOF (QUERY (app <* approval | NOT
           (1 <= SIZEOF (QUERY (apo <* approval_person_organization |
               (app :=: apo.authorized_approval))))
        )));
END_RULE;


RULE approval_requires_assignment FOR
  (approval, approval_assignment);
WHERE
  WR1:  (0 = SIZEOF (QUERY (app <* approval | NOT
           (1 <= SIZEOF (QUERY (aa <* approval_assignment |
               (app :=: aa.assigned_approval))))
        )));
END_RULE; 

RULE dependent_instantiable_approval_status FOR (approval_status);
WHERE
  WR1:  (0 = SIZEOF (QUERY (ast <* approval_status | NOT
           (1 <= SIZEOF (USEDIN (ast, '')))
        )));
END_RULE;


RULE dependent_instantiable_named_unit FOR (named_unit);
WHERE
  WR1:  (0 = SIZEOF (QUERY (nu <* named_unit | NOT
           (1 <= SIZEOF (USEDIN (nu, '')))
        )));
END_RULE;


RULE machining_project_requires_owner FOR
  (product_definition_formation);
WHERE
  WR1: (0 = SIZEOF (QUERY (pdf <* product_definition_formation |
          -- it is machining project
          (0 < SIZEOF (QUERY (prpc <* USEDIN (pdf.of_product, 
             'INTEGRATED_CNC_SCHEMA.' +
             'PRODUCT_RELATED_PRODUCT_CATEGORY.PRODUCTS') |
               (prpc.name = 'machining project'))))  AND NOT

          -- it has at most one associated owner.
          (1 >= SIZEOF (QUERY (poa <* USEDIN (pdf, 
             'INTEGRATED_CNC_SCHEMA.' + 
             'APPLIED_PERSON_AND_ORGANIZATION_ASSIGNMENT.ITEMS') |
               (poa.role.name = 'owner'))))
        )));
END_RULE;


RULE machining_project_requires_release_date FOR
  (product_definition_formation);
WHERE
  WR1: (0 = SIZEOF (QUERY (pdf <* product_definition_formation |
          -- it is machining project
          (0 < SIZEOF (QUERY (prpc <* USEDIN (pdf.of_product, 
             'INTEGRATED_CNC_SCHEMA.' + 
             'PRODUCT_RELATED_PRODUCT_CATEGORY.PRODUCTS') |
               (prpc.name = 'machining project'))))  AND NOT

          -- it has at most one associated release date.
          (1 >= SIZEOF (QUERY (dta <* USEDIN (pdf, 
             'INTEGRATED_CNC_SCHEMA.' + 
             'APPLIED_DATE_AND_TIME_ASSIGNMENT.ITEMS') |
               (dta.role.name = 'release date'))))
        )));
END_RULE;


RULE machining_project_requires_workplan FOR
  (product_definition_formation, process_product_association);
WHERE
  WR1: (0 = SIZEOF (QUERY (pdf <* product_definition_formation |
          -- it is machining project
          (0 < SIZEOF (QUERY (prpc <* USEDIN (pdf.of_product, 
             'INTEGRATED_CNC_SCHEMA.' + 
             'PRODUCT_RELATED_PRODUCT_CATEGORY.PRODUCTS') |
               (prpc.name = 'machining project'))))  AND NOT

          -- it has one associated workplan.
          (1 = SIZEOF (QUERY (ppa <* process_product_association |
             (ppa.process.name = 'machining') AND
             (ppa.defined_product.formation :=: pdf) AND
             ('INTEGRATED_CNC_SCHEMA.MACHINING_WORKPLAN'
               IN TYPEOF (ppa.process.chosen_method)))))        
        )));
END_RULE;


RULE machining_setup_requires_security_plane FOR
  (product_definition_formation, property_definition);
WHERE
  WR1: (0 = SIZEOF (QUERY (pdf <* product_definition_formation |
          -- it is machining setup
          (0 < SIZEOF (QUERY (prpc <* USEDIN (pdf.of_product, 
             'INTEGRATED_CNC_SCHEMA.' + 
             'PRODUCT_RELATED_PRODUCT_CATEGORY.PRODUCTS') |
               (prpc.name = 'machining setup'))))  AND NOT

          -- it has one associated security plane.
          (1 = SIZEOF (QUERY (pd <* property_definition |
             (pd.name = 'security plane') AND
             (pd.definition.formation :=: pdf) )))        
        )));
END_RULE;


RULE nc_variable_compatible_initial_value FOR
  (numeric_variable, representation_item_relationship);
WHERE
  -- each nc_variable has at most one one initial value
  WR1: (0 = SIZEOF (QUERY (nv <* numeric_variable | 
            ('INTEGRATED_CNC_SCHEMA.EXPRESSION_REPRESENTATION_ITEM'
	      IN TYPEOF (nv)) AND NOT
            (1 >= SIZEOF (QUERY (rir <* representation_item_relationship |
                   (rir.description = 'initial value')  AND
                   (rir.relating_representation_item :=:
		    nv\expression_representation_item )))))));


  -- the types on either side of the initial value relationship must match
  -- each nc_variable has at most one one initial value
  WR2: (0 = SIZEOF (QUERY (rir <* representation_item_relationship |
            (rir.description = 'initial value')  AND 
            ('INTEGRATED_CNC_SCHEMA.NUMERIC_VARIABLE'
              IN TYPEOF (rir.relating_representation_item)) 
	    AND NOT
            ((('INTEGRATED_CNC_SCHEMA.INT_NUMERIC_VARIABLE' 
                IN TYPEOF (rir.relating_representation_item)) AND
              ('INTEGRATED_CNC_SCHEMA.INT_LITERAL' 
                IN TYPEOF (rir.related_representation_item)))
             OR
            ((('INTEGRATED_CNC_SCHEMA.REAL_NUMERIC_VARIABLE' 
                IN TYPEOF (rir.relating_representation_item)) AND
              ('INTEGRATED_CNC_SCHEMA.REAL_LITERAL' 
                IN TYPEOF (rir.related_representation_item))))))));
END_RULE;

RULE product_requires_version FOR 
  (product, product_definition_formation);
WHERE
  WR1:  (0 = SIZEOF (QUERY (prod <* product  | NOT
           (1 <= SIZEOF (QUERY (pdf <* product_definition_formation |
               (prod :=: pdf.of_product))))
        )));
END_RULE;

(* Turning features are present for compatibility with AP-224,
   but are restricted until ISO 14649-12 is complete.
 *)
RULE restrict_turning_feature_usage FOR (feature_definition);
  WHERE
  WR1:  (0 = SIZEOF (QUERY (fd <* feature_definition |
	 ('INTEGRATED_CNC_SCHEMA.OUTER_ROUND' IN TYPEOF(fd)) OR 
 	 ('INTEGRATED_CNC_SCHEMA.REVOLVED_PROFILE' IN TYPEOF(fd)) OR 
	 ('INTEGRATED_CNC_SCHEMA.TURNED_KNURL' IN TYPEOF(fd))
	)));
END_RULE;

RULE security_classification_requires_assignment FOR 
  (security_classification, security_classification_assignment);
WHERE
  WR1:  (0 = SIZEOF (QUERY (sc <* security_classification  | NOT
           (1 <= SIZEOF (QUERY (sca <* security_classification_assignment |
               (sc :=: sca.assigned_security_classification))))
        )));
END_RULE; 


END_SCHEMA;  -- integrated_cnc_schema
